<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeQuest Pro - JavaScriptÂÜíÈô∫</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Fredoka:wght@600;700&family=Orbitron:wght@400;700&display=swap');
        
        :root {
            --bg-primary: #0a0e17;
            --bg-secondary: #141b2d;
            --bg-tertiary: #1e2a45;
            --bg-card: #182035;
            --accent-primary: #00f5ff;
            --accent-secondary: #ff2d75;
            --accent-tertiary: #b14eff;
            --accent-success: #00ff88;
            --accent-warning: #ffcc00;
            --accent-orange: #ff7b00;
            --text-primary: #e8f4f8;
            --text-secondary: #8892b0;
            --text-code: #7dd3fc;
            --glow-primary: rgba(0, 245, 255, 0.5);
            --glow-secondary: rgba(255, 45, 117, 0.5);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Space Mono', monospace;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Animated starfield background */
        .starfield {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        /* Nebula effect */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(177, 78, 255, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(0, 245, 255, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(255, 45, 117, 0.08) 0%, transparent 60%);
            animation: nebulaPulse 15s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }
        
        @keyframes nebulaPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }
        
        .container {
            position: relative;
            z-index: 1;
            max-width: 1600px;
            margin: 0 auto;
            padding: 1.5rem;
        }
        
        header {
            text-align: center;
            margin-bottom: 1.5rem;
            animation: fadeInDown 0.8s ease;
        }
        
        .logo-container {
            display: inline-block;
            position: relative;
        }
        
        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 3.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-tertiary) 50%, var(--accent-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 0.1em;
            position: relative;
            animation: logoGlow 3s ease-in-out infinite;
        }
        
        @keyframes logoGlow {
            0%, 100% { 
                filter: drop-shadow(0 0 20px var(--glow-primary)) drop-shadow(0 0 40px var(--glow-secondary));
            }
            50% { 
                filter: drop-shadow(0 0 30px var(--glow-primary)) drop-shadow(0 0 60px var(--glow-secondary));
            }
        }
        
        .subtitle {
            font-family: 'Fredoka', sans-serif;
            color: var(--text-secondary);
            font-size: 1.1rem;
            letter-spacing: 0.3em;
            margin-top: 0.5rem;
        }
        
        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--bg-secondary);
            border-radius: 20px;
            border: 1px solid rgba(0, 245, 255, 0.2);
        }
        
        .stat-icon {
            font-size: 1.2rem;
        }
        
        .stat-value {
            font-family: 'Orbitron', sans-serif;
            color: var(--accent-primary);
            font-weight: 700;
        }
        
        .help-link {
            text-decoration: none;
            color: var(--accent-warning);
            border: 1px solid var(--accent-warning);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .help-link:hover {
            background: var(--accent-warning);
            color: var(--bg-primary);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 204, 0, 0.3);
        }
        
        .theme-toggle, .character-btn {
            cursor: pointer;
            border: 1px solid var(--accent-tertiary);
            color: var(--accent-tertiary);
            transition: all 0.3s ease;
        }
        
        .theme-toggle:hover, .character-btn:hover {
            background: var(--accent-tertiary);
            color: var(--bg-primary);
            transform: translateY(-2px);
        }
        
        /* Character Selector Modal */
        .character-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .character-modal.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        .character-modal-content {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            border: 2px solid var(--accent-primary);
            box-shadow: 0 20px 60px rgba(0, 245, 255, 0.3);
        }
        
        .character-modal h2 {
            font-family: 'Orbitron', sans-serif;
            color: var(--accent-primary);
            text-align: center;
            margin-bottom: 1.5rem;
        }
        
        .character-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .character-card {
            background: var(--bg-secondary);
            border: 3px solid var(--bg-tertiary);
            border-radius: 16px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .character-card:hover {
            border-color: var(--accent-primary);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 245, 255, 0.2);
        }
        
        .character-card.selected {
            border-color: var(--accent-success);
            background: rgba(0, 255, 136, 0.1);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }
        
        .character-preview {
            width: 80px;
            height: 80px;
            margin: 0 auto 0.75rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .character-name {
            font-family: 'Fredoka', sans-serif;
            font-size: 1.1rem;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }
        
        .character-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        .character-modal-close {
            display: block;
            width: 100%;
            padding: 0.75rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-tertiary));
            color: var(--bg-primary);
            border: none;
            border-radius: 10px;
            font-family: 'Fredoka', sans-serif;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .character-modal-close:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 245, 255, 0.4);
        }
        
        /* ===== LIGHT MODE ===== */
        body.light-mode {
            --bg-primary: #e8ecf2;
            --bg-secondary: #ffffff;
            --bg-tertiary: #d1d9e6;
            --bg-card: #ffffff;
            --text-primary: #1a202c;
            --text-secondary: #374151;
            --text-code: #7c3aed;
            --grid-color: #94a3b8;
            --border-color: #cbd5e1;
            --accent-primary: #0891b2;
            --accent-secondary: #db2777;
            --accent-tertiary: #7c3aed;
            --accent-success: #10b981;
            --accent-warning: #f59e0b;
        }
        
        body.light-mode::before {
            background: 
                radial-gradient(circle at 20% 30%, rgba(0, 180, 220, 0.12) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(147, 51, 234, 0.12) 0%, transparent 50%);
        }
        
        body.light-mode .starfield .star {
            background: rgba(100, 116, 139, 0.3);
        }
        
        body.light-mode .panel {
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.08),
                0 0 0 1px rgba(0, 0, 0, 0.06);
            border: 1px solid var(--border-color);
        }
        
        body.light-mode .panel::before {
            background: linear-gradient(90deg, #0891b2, #7c3aed);
        }
        
        body.light-mode canvas {
            background: #f1f5f9;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 2px solid #cbd5e1;
        }
        
        body.light-mode .code-editor textarea {
            background: #1e293b;
            color: #e879f9;
            border: 2px solid #475569;
        }
        
        body.light-mode .output {
            background: #f1f5f9;
            border: 1px solid #cbd5e1;
            color: #1e293b;
        }
        
        body.light-mode .hint-box {
            background: rgba(251, 191, 36, 0.15);
            border-color: #f59e0b;
        }
        
        body.light-mode .level-btn {
            background: #f1f5f9;
            border-color: #94a3b8;
            color: #475569;
        }
        
        body.light-mode .level-btn:hover {
            border-color: #0891b2;
            color: #0891b2;
            background: #e0f2fe;
        }
        
        body.light-mode .level-btn.active {
            background: linear-gradient(135deg, #0891b2, #7c3aed);
            color: white;
            border-color: #0891b2;
        }
        
        body.light-mode .world-btn {
            background: #f1f5f9;
            border-color: #94a3b8;
            color: #475569;
        }
        
        body.light-mode .world-btn:hover {
            border-color: #0891b2;
            color: #0891b2;
        }
        
        body.light-mode .world-btn.active {
            background: linear-gradient(135deg, #0891b2, #7c3aed);
            color: white;
        }
        
        body.light-mode .stat-item {
            background: #f1f5f9;
            border: 1px solid #cbd5e1;
        }
        
        body.light-mode .challenge-description {
            background: #f8fafc;
            border-left-color: #7c3aed;
            color: #1e293b;
        }
        
        body.light-mode .challenge-description code {
            background: #e0e7ff;
            color: #4338ca;
        }
        
        body.light-mode .success-message {
            background: rgba(16, 185, 129, 0.1);
            border-color: #10b981;
            color: #047857;
        }
        
        body.light-mode .error-message {
            background: rgba(239, 68, 68, 0.1);
            border-color: #ef4444;
            color: #dc2626;
        }
        
        body.light-mode .character-modal-content {
            background: #ffffff;
            border-color: #0891b2;
        }
        
        body.light-mode .character-card {
            background: #f8fafc;
            border-color: #cbd5e1;
        }
        
        body.light-mode .character-card:hover {
            border-color: #0891b2;
            background: #e0f2fe;
        }
        
        body.light-mode .character-card.selected {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }
        
        body.light-mode .quick-ref-panel {
            background: #ffffff;
            border-color: #cbd5e1;
        }
        
        body.light-mode .floating-help-btn {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        body.light-mode .panel-title {
            color: #0891b2;
        }
        
        body.light-mode .game-info {
            background: #f1f5f9;
            border: 1px solid #cbd5e1;
        }
        
        body.light-mode .info-item .label {
            color: #475569;
        }
        
        body.light-mode .run-btn {
            background: linear-gradient(135deg, #0891b2, #0e7490);
            box-shadow: 0 4px 12px rgba(8, 145, 178, 0.3);
        }
        
        body.light-mode .level-complete-modal {
            background: #ffffff;
            border-color: #0891b2;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1.2fr;
            gap: 1.5rem;
            animation: fadeInUp 0.8s ease 0.2s backwards;
        }
        
        .panel {
            background: linear-gradient(180deg, var(--bg-card) 0%, var(--bg-secondary) 100%);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 
                0 10px 40px rgba(0, 0, 0, 0.5),
                0 0 0 1px rgba(0, 245, 255, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
        }
        
        .panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-tertiary), var(--accent-secondary));
        }
        
        .panel::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 20px;
            background: linear-gradient(180deg, rgba(0, 245, 255, 0.2) 0%, transparent 100%);
            border-radius: 0 0 50% 50%;
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .panel-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            color: var(--accent-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        
        .world-selector {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .world-btn {
            padding: 0.4rem 0.8rem;
            border: 2px solid var(--bg-tertiary);
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }
        
        .world-btn:hover {
            border-color: var(--accent-tertiary);
            color: var(--accent-tertiary);
        }
        
        .world-btn.active {
            background: linear-gradient(135deg, var(--accent-tertiary), var(--accent-secondary));
            border-color: var(--accent-tertiary);
            color: white;
        }
        
        .level-selector {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.4rem;
            margin-bottom: 1rem;
        }
        
        .level-btn {
            padding: 0.5rem;
            border: 2px solid var(--bg-tertiary);
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 0.75rem;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .level-btn:hover {
            border-color: var(--accent-primary);
            color: var(--accent-primary);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 245, 255, 0.2);
        }
        
        .level-btn.active {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-tertiary));
            border-color: var(--accent-primary);
            color: var(--bg-primary);
            box-shadow: 0 0 20px var(--glow-primary);
        }
        
        .level-btn.completed {
            background: linear-gradient(135deg, var(--accent-success), #00cc6a);
            border-color: var(--accent-success);
            color: var(--bg-primary);
        }
        
        .level-btn .stars {
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.6rem;
            white-space: nowrap;
        }
        
        .challenge-box {
            background: var(--bg-tertiary);
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            border-left: 4px solid var(--accent-secondary);
            position: relative;
            overflow: hidden;
        }
        
        .challenge-box::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(255, 45, 117, 0.1) 0%, transparent 70%);
        }
        
        .challenge-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            color: var(--accent-warning);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .challenge-description {
            line-height: 1.6;
            font-size: 0.9rem;
        }
        
        .challenge-description code {
            background: var(--bg-primary);
            color: var(--text-code);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-family: 'Space Mono', monospace;
        }
        
        .new-concept {
            display: inline-block;
            background: linear-gradient(135deg, var(--accent-tertiary), var(--accent-secondary));
            color: white;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
            margin-left: 0.5rem;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(177, 78, 255, 0.4); }
            50% { box-shadow: 0 0 0 8px rgba(177, 78, 255, 0); }
        }
        
        .code-editor-container {
            position: relative;
            margin-bottom: 1rem;
        }
        
        .editor-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .editor-tab {
            padding: 0.4rem 1rem;
            background: var(--bg-tertiary);
            border: none;
            border-radius: 8px 8px 0 0;
            color: var(--text-secondary);
            font-family: 'Space Mono', monospace;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .editor-tab.active {
            background: var(--bg-primary);
            color: var(--accent-primary);
        }
        
        .code-editor {
            position: relative;
            background: var(--bg-primary);
            border-radius: 0 12px 12px 12px;
            overflow: hidden;
            border: 2px solid var(--bg-tertiary);
            transition: border-color 0.3s ease;
        }
        
        .code-editor:focus-within {
            border-color: var(--accent-primary);
            box-shadow: 0 0 20px rgba(0, 245, 255, 0.1);
        }
        
        .line-numbers {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3rem;
            background: var(--bg-secondary);
            border-right: 1px solid var(--bg-tertiary);
            padding: 1rem 0.5rem;
            font-size: 0.8rem;
            color: var(--text-secondary);
            user-select: none;
            line-height: 1.5;
            text-align: right;
            overflow: hidden;
        }
        
        textarea {
            width: 100%;
            height: 220px;
            background: transparent;
            color: var(--text-code);
            border: none;
            padding: 1rem 1rem 1rem 4rem;
            font-family: 'Space Mono', monospace;
            font-size: 0.9rem;
            resize: none;
            line-height: 1.5;
        }
        
        textarea:focus {
            outline: none;
        }
        
        .controls {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        button {
            padding: 0.75rem 1.25rem;
            border: none;
            border-radius: 10px;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .run-btn {
            background: linear-gradient(135deg, var(--accent-primary), #00b8c8);
            color: var(--bg-primary);
            flex: 1;
            box-shadow: 0 4px 15px rgba(0, 245, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .run-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 245, 255, 0.4);
        }
        
        .run-btn:active {
            transform: translateY(0);
        }
        
        .hint-btn {
            background: var(--bg-tertiary);
            color: var(--accent-warning);
            border: 2px solid var(--accent-warning);
        }
        
        .hint-btn:hover {
            background: var(--accent-warning);
            color: var(--bg-primary);
        }
        
        .reset-btn {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 2px solid var(--text-secondary);
        }
        
        .reset-btn:hover {
            background: var(--accent-secondary);
            border-color: var(--accent-secondary);
            color: white;
        }
        
        .hint-box {
            background: linear-gradient(135deg, rgba(255, 204, 0, 0.1), rgba(255, 123, 0, 0.1));
            border: 2px solid var(--accent-warning);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: none;
            animation: slideDown 0.3s ease;
        }
        
        .hint-box.show {
            display: block;
        }
        
        .hint-box code {
            display: block;
            background: var(--bg-primary);
            padding: 0.75rem;
            border-radius: 8px;
            margin-top: 0.5rem;
            color: var(--text-code);
            font-size: 0.85rem;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        
        .output {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 1rem;
            min-height: 80px;
            max-height: 120px;
            overflow-y: auto;
            font-size: 0.85rem;
            line-height: 1.5;
            border: 1px solid var(--bg-tertiary);
        }
        
        .output p {
            margin: 0.25rem 0;
            padding-left: 0.5rem;
            border-left: 2px solid var(--accent-primary);
        }
        
        .canvas-container {
            background: linear-gradient(180deg, #0d1321 0%, #151d32 100%);
            border-radius: 16px;
            padding: 1rem;
            position: relative;
            border: 2px solid var(--bg-tertiary);
            overflow: hidden;
        }
        
        .canvas-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 30% 30%, rgba(0, 245, 255, 0.05) 0%, transparent 40%),
                radial-gradient(circle at 70% 70%, rgba(177, 78, 255, 0.05) 0%, transparent 40%);
            pointer-events: none;
        }
        
        canvas {
            display: block;
            margin: 0 auto;
            border-radius: 8px;
            box-shadow: 
                0 0 30px rgba(0, 0, 0, 0.5),
                inset 0 0 50px rgba(0, 245, 255, 0.03);
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            padding: 0.75rem;
            background: var(--bg-tertiary);
            border-radius: 10px;
        }
        
        .game-info-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }
        
        .game-info-item .icon {
            font-size: 1.2rem;
        }
        
        .game-info-item .value {
            font-family: 'Orbitron', sans-serif;
            color: var(--accent-primary);
            font-weight: 700;
        }
        
        .success-message {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 204, 106, 0.2));
            border: 2px solid var(--accent-success);
            color: var(--accent-success);
            padding: 1rem;
            border-radius: 12px;
            text-align: center;
            font-weight: 700;
            animation: successPop 0.5s ease;
            margin-top: 1rem;
        }
        
        .error-message {
            background: linear-gradient(135deg, rgba(255, 45, 117, 0.2), rgba(255, 45, 117, 0.1));
            border: 2px solid var(--accent-secondary);
            color: var(--accent-secondary);
            padding: 1rem;
            border-radius: 12px;
            margin-top: 1rem;
        }
        
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes successPop {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        /* Celebration effects */
        .celebration-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            overflow: hidden;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            animation: confettiFall 3s linear forwards;
        }
        
        @keyframes confettiFall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        .level-complete-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 14, 23, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 999;
            animation: fadeIn 0.3s ease;
        }
        
        .level-complete-modal.show {
            display: flex;
        }
        
        .modal-content {
            background: linear-gradient(180deg, var(--bg-card) 0%, var(--bg-secondary) 100%);
            padding: 2.5rem;
            border-radius: 24px;
            text-align: center;
            max-width: 400px;
            border: 2px solid var(--accent-success);
            box-shadow: 0 0 60px rgba(0, 255, 136, 0.3);
            animation: modalPop 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes modalPop {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .modal-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            color: var(--accent-success);
            margin-bottom: 1rem;
        }
        
        .modal-stars {
            font-size: 3rem;
            margin: 1rem 0;
        }
        
        .modal-message {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }
        
        .modal-btn {
            background: linear-gradient(135deg, var(--accent-success), #00cc6a);
            color: var(--bg-primary);
            padding: 1rem 2rem;
            font-size: 1.1rem;
            border-radius: 12px;
            cursor: pointer;
        }
        
        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 255, 136, 0.4);
        }
        
        /* Quick Reference Panel */
        .quick-ref-panel {
            position: fixed;
            right: -350px;
            top: 50%;
            transform: translateY(-50%);
            width: 320px;
            max-height: 80vh;
            background: linear-gradient(180deg, var(--bg-card) 0%, var(--bg-secondary) 100%);
            border-radius: 20px 0 0 20px;
            box-shadow: -5px 0 30px rgba(0, 0, 0, 0.5);
            z-index: 998;
            transition: right 0.4s ease;
            overflow: hidden;
            border: 1px solid rgba(0, 245, 255, 0.2);
            border-right: none;
        }
        
        .quick-ref-panel.open {
            right: 0;
        }
        
        .quick-ref-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.25rem;
            background: var(--bg-tertiary);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .quick-ref-header h3 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            color: var(--accent-primary);
            margin: 0;
        }
        
        .quick-ref-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        
        .quick-ref-close:hover {
            background: var(--accent-secondary);
            color: white;
        }
        
        .quick-ref-content {
            padding: 1rem 1.25rem;
            overflow-y: auto;
            max-height: calc(80vh - 60px);
        }
        
        .quick-ref-section {
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .quick-ref-section:last-of-type {
            border-bottom: none;
        }
        
        .quick-ref-section h4 {
            font-family: 'Fredoka', sans-serif;
            font-size: 0.9rem;
            color: var(--accent-warning);
            margin-bottom: 0.5rem;
        }
        
        .quick-ref-section code {
            display: inline-block;
            background: var(--bg-primary);
            color: var(--text-code);
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            font-size: 0.8rem;
            margin: 0.15rem 0;
        }
        
        .full-ref-link {
            display: block;
            text-align: center;
            padding: 0.75rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-tertiary));
            color: var(--bg-primary);
            text-decoration: none;
            border-radius: 10px;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            margin-top: 0.5rem;
            transition: all 0.3s ease;
        }
        
        .full-ref-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 245, 255, 0.3);
        }
        
        /* Floating Help Button */
        .floating-help-btn {
            position: fixed;
            right: 20px;
            bottom: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-tertiary), var(--accent-secondary));
            border: none;
            color: white;
            font-size: 1.8rem;
            font-weight: 700;
            cursor: pointer;
            z-index: 997;
            box-shadow: 0 4px 20px rgba(177, 78, 255, 0.4);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .floating-help-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 30px rgba(177, 78, 255, 0.6);
        }
        
        .floating-help-btn.active {
            background: linear-gradient(135deg, var(--accent-secondary), var(--accent-tertiary));
            transform: rotate(45deg);
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--bg-tertiary);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-primary);
        }
        
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2.5rem;
            }
            
            .level-selector {
                grid-template-columns: repeat(5, 1fr);
            }
        }
        
        @media (max-width: 600px) {
            .level-selector {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .stats-bar {
                gap: 0.5rem;
            }
            
            .stat-item {
                padding: 0.3rem 0.6rem;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="starfield" id="starfield"></div>
    
    <div class="container">
        <header>
            <div class="logo-container">
                <h1>‚ö° CODEQUEST PRO</h1>
            </div>
            <p class="subtitle">JavaScript „Éû„Çπ„Çø„Éº„Å∏„ÅÆÈÅì</p>
            
            <div class="stats-bar">
                <div class="stat-item">
                    <span class="stat-icon">üèÜ</span>
                    <span>„ÇØ„É™„Ç¢:</span>
                    <span class="stat-value" id="completedCount">0</span>
                    <span>/80</span>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">‚≠ê</span>
                    <span>„Çπ„Çø„Éº:</span>
                    <span class="stat-value" id="totalStars">0</span>
                </div>
                <button class="stat-item theme-toggle" id="themeToggle" title="„ÉÜ„Éº„ÉûÂàáÊõø">
                    <span class="stat-icon" id="themeIcon">üåô</span>
                    <span id="themeText">„ÉÄ„Éº„ÇØ</span>
                </button>
                <button class="stat-item character-btn" id="characterBtn" title="„Ç≠„É£„É©„ÇØ„Çø„ÉºÈÅ∏Êäû">
                    <span class="stat-icon">ü§ñ</span>
                    <span>„Ç≠„É£„É©</span>
                </button>
                <a href="codequest-reference.html" class="stat-item help-link">
                    <span class="stat-icon">üìñ</span>
                    <span>„É™„Éï„Ç°„É¨„É≥„Çπ</span>
                </a>
            </div>
        </header>
        
        <div class="main-grid">
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">üìù „Ç≥„Éº„Éâ„Ç®„Éá„Ç£„Çø</h2>
                </div>
                
                <div class="world-selector" id="worldSelector">
                    <button class="world-btn active" data-world="1">üåç Âü∫Á§é</button>
                    <button class="world-btn" data-world="2">üîÅ „É´„Éº„Éó</button>
                    <button class="world-btn" data-world="3">üîÄ Êù°‰ª∂</button>
                    <button class="world-btn" data-world="4">‚öôÔ∏è Èñ¢Êï∞</button>
                </div>
                
                <div class="level-selector" id="levelSelector"></div>
                
                <div class="challenge-box">
                    <div class="challenge-title" id="challengeTitle">
                        <span>üéØ „Éü„ÉÉ„Ç∑„Éß„É≥</span>
                    </div>
                    <div class="challenge-description" id="challengeDescription"></div>
                </div>
                
                <div class="hint-box" id="hintBox"></div>
                
                <div class="code-editor-container">
                    <div class="editor-tabs">
                        <button class="editor-tab active">main.js</button>
                    </div>
                    <div class="code-editor">
                        <div class="line-numbers" id="lineNumbers">1</div>
                        <textarea id="codeInput" spellcheck="false"></textarea>
                    </div>
                </div>
                
                <div class="controls">
                    <button class="run-btn" id="runBtn">
                        <span>‚ñ∂</span>
                        <span>ÂÆüË°å</span>
                    </button>
                    <button class="hint-btn" id="hintBtn">üí°</button>
                    <button class="reset-btn" id="resetBtn">‚Ü∫</button>
                </div>
                
                <div class="output" id="output"></div>
            </div>
            
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">üéÆ „Ç∑„Éü„É•„É¨„Éº„Çø„Éº</h2>
                </div>
                
                <div class="canvas-container">
                    <canvas id="gameCanvas" width="580" height="420"></canvas>
                </div>
                
                <div class="game-info">
                    <div class="game-info-item">
                        <span class="icon">ü§ñ</span>
                        <span>‰ΩçÁΩÆ:</span>
                        <span class="value" id="robotPos">(0, 0)</span>
                    </div>
                    <div class="game-info-item">
                        <span class="icon">‚≠ê</span>
                        <span>ÂèéÈõÜ:</span>
                        <span class="value" id="starsCollected">0</span>
                    </div>
                    <div class="game-info-item">
                        <span class="icon">üíé</span>
                        <span>„Ç∏„Çß„É†:</span>
                        <span class="value" id="gemsCollected">0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="celebration-container" id="celebrationContainer"></div>
    
    <div class="level-complete-modal" id="levelCompleteModal">
        <div class="modal-content">
            <h2 class="modal-title">üéâ „ÇØ„É™„Ç¢!</h2>
            <div class="modal-stars" id="modalStars">‚≠ê‚≠ê‚≠ê</div>
            <p class="modal-message" id="modalMessage">Á¥†Êô¥„Çâ„Åó„ÅÑ! Ê¨°„ÅÆ„É¨„Éô„É´„Å´ÊåëÊà¶„Åó„Çà„ÅÜ!</p>
            <button class="modal-btn" id="nextLevelBtn">Ê¨°„Å∏ÈÄ≤„ÇÄ ‚Üí</button>
        </div>
    </div>
    
    <!-- Quick Reference Panel -->
    <div class="quick-ref-panel" id="quickRefPanel">
        <div class="quick-ref-header">
            <h3>üìñ „ÇØ„Ç§„ÉÉ„ÇØ„É™„Éï„Ç°„É¨„É≥„Çπ</h3>
            <button class="quick-ref-close" id="closeQuickRef">‚úï</button>
        </div>
        <div class="quick-ref-content">
            <div class="quick-ref-section">
                <h4>üö∂ ÁßªÂãï</h4>
                <code>robot.move()</code> - Âè≥„Å´1„Éû„Çπ<br>
                <code>robot.moveUp()</code> - ‰∏ä„Å´1„Éû„Çπ<br>
                <code>robot.moveDown()</code> - ‰∏ã„Å´1„Éû„Çπ<br>
                <code>robot.jump()</code> - „Ç∏„É£„É≥„ÉóÔºàÈöúÂÆ≥Áâ©Ë∂ä„ÅàÔºâ
            </div>
            <div class="quick-ref-section">
                <h4>‚≠ê ÂèéÈõÜ</h4>
                <code>robot.collect()</code> - Êòü„ÇíÂèéÈõÜ<br>
                <code>robot.collectGem()</code> - „Ç∏„Çß„É†„ÇíÂèéÈõÜ
            </div>
            <div class="quick-ref-section">
                <h4>üîç „ÉÅ„Çß„ÉÉ„ÇØ</h4>
                <code>robot.isObstacle()</code> - ÂâçÊñπ„Å´ÈöúÂÆ≥Áâ©?<br>
                <code>robot.isStar()</code> - Êòü„Åå„ÅÇ„Çã?<br>
                <code>robot.isGem()</code> - „Ç∏„Çß„É†„Åå„ÅÇ„Çã?<br>
                <code>robot.isGoal()</code> - „Ç¥„Éº„É´?
            </div>
            <div class="quick-ref-section">
                <h4>üìä Áä∂ÊÖã</h4>
                <code>robot.x</code> - XÂ∫ßÊ®ô<br>
                <code>robot.y</code> - YÂ∫ßÊ®ô<br>
                <code>robot.starsCollected</code> - Êòü„ÅÆÊï∞
            </div>
            <a href="codequest-reference.html" class="full-ref-link">üìö Ë©≥„Åó„ÅÑ„É™„Éï„Ç°„É¨„É≥„Çπ„ÇíË¶ã„Çã ‚Üí</a>
        </div>
    </div>
    
    <!-- Floating Help Button -->
    <button class="floating-help-btn" id="floatingHelpBtn" title="„ÇØ„Ç§„ÉÉ„ÇØ„É™„Éï„Ç°„É¨„É≥„Çπ">
        <span>?</span>
    </button>
    
    <!-- Character Selection Modal -->
    <div class="character-modal" id="characterModal">
        <div class="character-modal-content">
            <h2>ü§ñ „Ç≠„É£„É©„ÇØ„Çø„ÉºÈÅ∏Êäû</h2>
            <div class="character-grid" id="characterGrid">
                <!-- Characters will be added by JavaScript -->
            </div>
            <button class="character-modal-close" id="closeCharacterModal">Ê±∫ÂÆö</button>
        </div>
    </div>

    <script>
        // ===== CHARACTERS =====
        const characters = [
            {
                id: 'pixel',
                name: 'Pixel',
                desc: '„ÇØ„É©„Ç∑„ÉÉ„ÇØ„É≠„Éú„ÉÉ„Éà',
                colors: {
                    body: '#00f5ff',
                    bodyGlow: '#00d4dd',
                    eye: '#00ff88',
                    antenna: '#ff2d75',
                    chest: ['#ff2d75', '#00ff88', '#ffcc00']
                }
            },
            {
                id: 'blaze',
                name: 'Blaze',
                desc: 'ÁÇé„ÅÆ„É≠„Éú„ÉÉ„Éà',
                colors: {
                    body: '#ff6b35',
                    bodyGlow: '#ff4500',
                    eye: '#ffcc00',
                    antenna: '#ff0000',
                    chest: ['#ff0000', '#ff6b35', '#ffcc00']
                }
            },
            {
                id: 'nova',
                name: 'Nova',
                desc: 'ÂÆáÂÆô„É≠„Éú„ÉÉ„Éà',
                colors: {
                    body: '#b14eff',
                    bodyGlow: '#9333ea',
                    eye: '#00ffff',
                    antenna: '#ff00ff',
                    chest: ['#ff00ff', '#00ffff', '#b14eff']
                }
            },
            {
                id: 'leaf',
                name: 'Leaf',
                desc: 'Ëá™ÁÑ∂„É≠„Éú„ÉÉ„Éà',
                colors: {
                    body: '#22c55e',
                    bodyGlow: '#16a34a',
                    eye: '#a3e635',
                    antenna: '#84cc16',
                    chest: ['#22c55e', '#84cc16', '#a3e635']
                }
            },
            {
                id: 'frost',
                name: 'Frost',
                desc: 'Ê∞∑„ÅÆ„É≠„Éú„ÉÉ„Éà',
                colors: {
                    body: '#38bdf8',
                    bodyGlow: '#0ea5e9',
                    eye: '#ffffff',
                    antenna: '#e0f2fe',
                    chest: ['#bae6fd', '#7dd3fc', '#38bdf8']
                }
            },
            {
                id: 'shadow',
                name: 'Shadow',
                desc: 'ÂΩ±„ÅÆ„É≠„Éú„ÉÉ„Éà',
                colors: {
                    body: '#6b7280',
                    bodyGlow: '#4b5563',
                    eye: '#ef4444',
                    antenna: '#991b1b',
                    chest: ['#ef4444', '#6b7280', '#374151']
                }
            }
        ];
        
        let selectedCharacter = characters[0];
        let isDarkMode = true;
        
        // ===== THEME TOGGLE =====
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('light-mode', !isDarkMode);
            document.getElementById('themeIcon').textContent = isDarkMode ? 'üåô' : '‚òÄÔ∏è';
            document.getElementById('themeText').textContent = isDarkMode ? '„ÉÄ„Éº„ÇØ' : '„É©„Ç§„Éà';
            localStorage.setItem('codequest-theme', isDarkMode ? 'dark' : 'light');
            drawCanvas();
        }
        
        // ===== CHARACTER SELECTOR =====
        function initCharacterSelector() {
            const grid = document.getElementById('characterGrid');
            grid.innerHTML = '';
            
            characters.forEach((char, index) => {
                const card = document.createElement('div');
                card.className = 'character-card' + (char.id === selectedCharacter.id ? ' selected' : '');
                card.innerHTML = `
                    <div class="character-preview">
                        <canvas id="charPreview${index}" width="60" height="60"></canvas>
                    </div>
                    <div class="character-name">${char.name}</div>
                    <div class="character-desc">${char.desc}</div>
                `;
                card.addEventListener('click', () => selectCharacter(char, card));
                grid.appendChild(card);
                
                // Draw preview
                setTimeout(() => drawCharacterPreview(index, char), 10);
            });
        }
        
        function drawCharacterPreview(index, char) {
            const canvas = document.getElementById('charPreview' + index);
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, 60, 60);
            drawRobotWithColors(ctx, 30, 35, char.colors, 0.8);
        }
        
        function selectCharacter(char, card) {
            selectedCharacter = char;
            document.querySelectorAll('.character-card').forEach(c => c.classList.remove('selected'));
            card.classList.add('selected');
            localStorage.setItem('codequest-character', char.id);
            drawCanvas();
        }
        
        function loadSavedPreferences() {
            // Load theme
            const savedTheme = localStorage.getItem('codequest-theme');
            if (savedTheme === 'light') {
                isDarkMode = false;
                document.body.classList.add('light-mode');
                document.getElementById('themeIcon').textContent = '‚òÄÔ∏è';
                document.getElementById('themeText').textContent = '„É©„Ç§„Éà';
            }
            
            // Load character
            const savedChar = localStorage.getItem('codequest-character');
            if (savedChar) {
                const found = characters.find(c => c.id === savedChar);
                if (found) selectedCharacter = found;
            }
        }
        
        // ===== LEVEL DATA =====
        const levels = [
            // ===== WORLD 1: BASICS (1-20) =====
            {
                id: 1, world: 1,
                title: "üöÄ ÊúÄÂàù„ÅÆ‰∏ÄÊ≠©",
                description: "„É≠„Éú„ÉÉ„Éà„ÇíÂè≥„Å´ <strong>2„Éû„Çπ</strong> Âãï„Åã„Åù„ÅÜ!<br><code>robot.move()</code> „Åß1„Éû„ÇπÁßªÂãï„ÄÇ",
                initialCode: "// robot.move() „Çí‰Ωø„Åä„ÅÜ!\n\n",
                hint: "move() „Çí2ÂõûÊõ∏„Åì„ÅÜ",
                goalX: 2, goalY: 0,
                obstacles: [], stars: [], gems: [],
                validate: (r) => r.x === 2 && r.y === 0
            },
            {
                id: 2, world: 1,
                title: "üèÉ 3„Éû„ÇπÈÄ≤„ÇÅ",
                description: "Âè≥„Å´ <strong>3„Éû„Çπ</strong> ÁßªÂãï„Åó„Çà„ÅÜ!",
                initialCode: "// 3„Éû„ÇπÈÄ≤„ÇÇ„ÅÜ!\n\n",
                hint: "move() „Çí3Âõû",
                goalX: 3, goalY: 0,
                obstacles: [], stars: [], gems: [],
                validate: (r) => r.x === 3 && r.y === 0
            },
            {
                id: 3, world: 1,
                title: "üéØ 4„Éû„ÇπÈÄ≤„ÇÅ",
                description: "Âè≥„Å´ <strong>4„Éû„Çπ</strong> ÁßªÂãï„Åó„Çà„ÅÜ!",
                initialCode: "// 4„Éû„ÇπÈÄ≤„ÇÇ„ÅÜ!\n\n",
                hint: "move() „Çí4Âõû",
                goalX: 4, goalY: 0,
                obstacles: [], stars: [], gems: [],
                validate: (r) => r.x === 4 && r.y === 0
            },
            {
                id: 4, world: 1,
                title: "‚¨ÜÔ∏è ‰∏ä„Å´ÁßªÂãï",
                description: "<code>robot.moveUp()</code> „Åß‰∏ä„Å´ÁßªÂãï!<br>Âè≥„Å´1„Éû„Çπ„ÄÅ‰∏ä„Å´1„Éû„Çπ„ÄÇ",
                initialCode: "// moveUp() „Çí‰Ωø„Åä„ÅÜ!\n\n",
                hint: "move() „ÅßÂè≥„ÄÅmoveUp() „Åß‰∏ä",
                goalX: 1, goalY: -1,
                obstacles: [], stars: [], gems: [],
                validate: (r) => r.x === 1 && r.y === -1
            },
            {
                id: 5, world: 1,
                title: "‚¨áÔ∏è ‰∏ã„Å´ÁßªÂãï",
                description: "<code>robot.moveDown()</code> „Åß‰∏ã„Å´ÁßªÂãï!<br>Âè≥„Å´1„Éû„Çπ„ÄÅ‰∏ã„Å´1„Éû„Çπ„ÄÇ",
                initialCode: "// moveDown() „Çí‰Ωø„Åä„ÅÜ!\n\n",
                hint: "move() „ÅßÂè≥„ÄÅmoveDown() „Åß‰∏ã",
                goalX: 1, goalY: 1,
                obstacles: [], stars: [], gems: [],
                validate: (r) => r.x === 1 && r.y === 1
            },
            {
                id: 6, world: 1,
                title: "‚ÜóÔ∏è Êñú„ÇÅÁßªÂãï",
                description: "Âè≥„Å´2„Éû„Çπ„ÄÅ‰∏ä„Å´1„Éû„ÇπÈÄ≤„ÇÇ„ÅÜ!",
                initialCode: "// Âè≥„Å®‰∏ä„ÇíÁµÑ„ÅøÂêà„Çè„Åõ!\n\n",
                hint: "move()„Çí2Âõû„ÄÅmoveUp()„Çí1Âõû",
                goalX: 2, goalY: -1,
                obstacles: [], stars: [], gems: [],
                validate: (r) => r.x === 2 && r.y === -1
            },
            {
                id: 7, world: 1,
                title: "‚ÜòÔ∏è ÂèçÂØæ„ÅÆÊñú„ÇÅ",
                description: "Âè≥„Å´2„Éû„Çπ„ÄÅ‰∏ã„Å´1„Éû„ÇπÈÄ≤„ÇÇ„ÅÜ!",
                initialCode: "// Âè≥„Å®‰∏ã„ÇíÁµÑ„ÅøÂêà„Çè„Åõ!\n\n",
                hint: "move()„Çí2Âõû„ÄÅmoveDown()„Çí1Âõû",
                goalX: 2, goalY: 1,
                obstacles: [], stars: [], gems: [],
                validate: (r) => r.x === 2 && r.y === 1
            },
            {
                id: 8, world: 1,
                title: "üîº ‰∏ä„Å´2„Éû„Çπ",
                description: "Âè≥„Å´1„Éû„Çπ„ÄÅ‰∏ä„Å´2„Éû„ÇπÈÄ≤„ÇÇ„ÅÜ!",
                initialCode: "// ‰∏ä„Å´2ÂõûÁßªÂãï!\n\n",
                hint: "moveUp()„Çí2Âõû‰Ωø„Åä„ÅÜ",
                goalX: 1, goalY: -2,
                obstacles: [], stars: [], gems: [],
                validate: (r) => r.x === 1 && r.y === -2
            },
            {
                id: 9, world: 1,
                title: "‚≠ê Êòü„ÇíÈõÜ„ÇÅ„Çà„ÅÜ",
                description: "<code>robot.collect()</code> „ÅßÊòü„ÇíÂèéÈõÜ!<br>‰ΩçÁΩÆ1„ÅÆÊòü„ÇíÈõÜ„ÇÅ„Å¶„Ç¥„Éº„É´„Å∏„ÄÇ",
                initialCode: "// collect() „ÅßÊòü„ÇíÈõÜ„ÇÅ„Çà„ÅÜ!\n\n",
                hint: "Êòü„ÅÆ‰ΩçÁΩÆ„Åß collect() „ÇíÂëº„Åº„ÅÜ",
                goalX: 2, goalY: 0,
                obstacles: [], stars: [1], gems: [],
                validate: (r) => r.x === 2 && r.starsCollected >= 1
            },
            {
                id: 10, world: 1,
                title: "‚≠ê‚≠ê 2„Å§„ÅÆÊòü",
                description: "2„Å§„ÅÆÊòü„ÇíÈõÜ„ÇÅ„Çà„ÅÜ!<br>Êòü„ÅØ‰ΩçÁΩÆ1„Å®2„Å´„ÅÇ„Çä„Åæ„Åô„ÄÇ",
                initialCode: "// 2„Å§ÈõÜ„ÇÅ„Çà„ÅÜ!\n\n",
                hint: "ÁßªÂãï„Åó„Å¶ collect() „ÇíÁπ∞„ÇäËøî„Åô",
                goalX: 3, goalY: 0,
                obstacles: [], stars: [1, 2], gems: [],
                validate: (r) => r.x === 3 && r.starsCollected >= 2
            },
            {
                id: 11, world: 1,
                title: "üß± ÈöúÂÆ≥Áâ©„Å†!",
                description: "<code>robot.jump()</code> „ÅßÈöúÂÆ≥Áâ©„ÇíÈ£õ„Å≥Ë∂ä„Åà„Çà„ÅÜ!",
                initialCode: "// jump() „Åß„Ç∏„É£„É≥„Éó!\n\n",
                hint: "ÈöúÂÆ≥Áâ©„ÅÆÊâãÂâç„Åß jump()",
                goalX: 2, goalY: 0,
                obstacles: [{x: 1, y: 0}], stars: [], gems: [],
                validate: (r) => r.x === 2 && !r.hitObstacle
            },
            {
                id: 12, world: 1,
                title: "üß±‚û°Ô∏è „Ç∏„É£„É≥„Éó„Å®ÁßªÂãï",
                description: "„Ç∏„É£„É≥„Éó„Åó„Å¶„ÄÅ„Åï„Çâ„Å´1„Éû„ÇπÈÄ≤„ÇÇ„ÅÜ!",
                initialCode: "// „Ç∏„É£„É≥„ÉóÂæå„ÇÇÁßªÂãï!\n\n",
                hint: "jump() „ÅÆÂæå„Å´ move()",
                goalX: 3, goalY: 0,
                obstacles: [{x: 1, y: 0}], stars: [], gems: [],
                validate: (r) => r.x === 3 && !r.hitObstacle
            },
            {
                id: 13, world: 1,
                title: "üíé „Ç∏„Çß„É†„ÇíÈõÜ„ÇÅ„Çç",
                description: "<code>robot.collectGem()</code> „Åß„Ç∏„Çß„É†ÂèéÈõÜ!",
                initialCode: "// collectGem() „Çí‰Ωø„Åä„ÅÜ!\n\n",
                hint: "„Ç∏„Çß„É†„ÅÆ‰ΩçÁΩÆ„Åß collectGem()",
                goalX: 2, goalY: 0,
                obstacles: [], stars: [], gems: [1],
                validate: (r) => r.x === 2 && r.gemsCollected >= 1
            },
            {
                id: 14, world: 1,
                title: "‚≠êüíé Êòü„Å®„Ç∏„Çß„É†",
                description: "Êòü„Å®„Ç∏„Çß„É†„Çí‰∏°ÊñπÈõÜ„ÇÅ„Çà„ÅÜ!",
                initialCode: "// ‰∏°ÊñπÈõÜ„ÇÅ„Çà„ÅÜ!\n\n",
                hint: "collect() „Å® collectGem() „Çí‰Ωø„ÅÑÂàÜ„Åë",
                goalX: 3, goalY: 0,
                obstacles: [], stars: [1], gems: [2],
                validate: (r) => r.x === 3 && r.starsCollected >= 1 && r.gemsCollected >= 1
            },
            {
                id: 15, world: 1,
                title: "üèîÔ∏è ‰∏ä‰∏ã„ÅÆÂÜíÈô∫",
                description: "‰∏ä„Å´Ë°å„Å£„Å¶Êòü„ÇíÂèñ„Çä„ÄÅ‰∏ã„Å´Êàª„Çç„ÅÜ!",
                initialCode: "// ‰∏ä‰∏ãÁßªÂãï„ÅßÊòü„ÇíÂèñ„Çç„ÅÜ!\n\n",
                hint: "moveUp() ‚Üí collect() ‚Üí moveDown()",
                goalX: 1, goalY: 0,
                obstacles: [], stars: [1], gems: [],
                validate: (r) => r.x === 1 && r.y === 0 && r.starsCollected >= 1
            },
            {
                id: 16, world: 1,
                title: "üéØ Á≤æÂØÜÊìç‰Ωú",
                description: "ÈöúÂÆ≥Áâ©„ÇíÈÅø„Åë„Å¶Êòü„ÇíÈõÜ„ÇÅ„Çà„ÅÜ!",
                initialCode: "// „Ç∏„É£„É≥„Éó„Åó„Å¶Êòü„ÇíÂèñ„Çç„ÅÜ!\n\n",
                hint: "jump() „ÅßÈ£õ„Å≥Ë∂ä„Åà„ÅüÂæå„Å´ collect()",
                goalX: 3, goalY: 0,
                obstacles: [{x: 1, y: 0}], stars: [2], gems: [],
                validate: (r) => r.x === 3 && r.starsCollected >= 1 && !r.hitObstacle
            },
            {
                id: 17, world: 1,
                title: "üåü 3„Å§„ÅÆÊòü",
                description: "3„Å§„ÅÆÊòü„ÇíÂÖ®ÈÉ®ÈõÜ„ÇÅ„Çà„ÅÜ!",
                initialCode: "// 3„Å§ÂÖ®ÈÉ®!\n\n",
                hint: "‰ΩçÁΩÆ1,2,3„Åß collect()",
                goalX: 4, goalY: 0,
                obstacles: [], stars: [1, 2, 3], gems: [],
                validate: (r) => r.x === 4 && r.starsCollected >= 3
            },
            {
                id: 18, world: 1,
                title: "üß±üß± 2„Å§„ÅÆÈöúÂÆ≥Áâ©",
                description: "2„Å§„ÅÆÈöúÂÆ≥Áâ©„ÇíÈ£õ„Å≥Ë∂ä„Åà„Çà„ÅÜ!",
                initialCode: "// 2Âõû„Ç∏„É£„É≥„Éó!\n\n",
                hint: "jump() „Çí2Âõû‰Ωø„Åä„ÅÜ",
                goalX: 4, goalY: 0,
                obstacles: [{x: 1, y: 0}, {x: 3, y: 0}], stars: [], gems: [],
                validate: (r) => r.x === 4 && !r.hitObstacle
            },
            {
                id: 19, world: 1,
                title: "üíéüíé 2„Å§„ÅÆ„Ç∏„Çß„É†",
                description: "2„Å§„ÅÆ„Ç∏„Çß„É†„ÇíÈõÜ„ÇÅ„Çà„ÅÜ!",
                initialCode: "// „Ç∏„Çß„É†2„Å§!\n\n",
                hint: "collectGem() „Çí2Âõû",
                goalX: 3, goalY: 0,
                obstacles: [], stars: [], gems: [1, 2],
                validate: (r) => r.x === 3 && r.gemsCollected >= 2
            },
            {
                id: 20, world: 1,
                title: "üèÜ Âü∫Á§é„Éû„Çπ„Çø„Éº",
                description: "ÂÖ®„Çπ„Ç≠„É´„Çí‰Ωø„Å£„Å¶„Ç¥„Éº„É´„Å∏!<br>ÈöúÂÆ≥Áâ©„ÄÅÊòü„ÄÅ„Ç∏„Çß„É†„Å´ÂØæÂøú!",
                initialCode: "// Âü∫Á§é„ÅÆÈõÜÂ§ßÊàê!\n\n",
                hint: "jump, collect, collectGem „ÇíÁµÑ„ÅøÂêà„Çè„Åõ",
                goalX: 5, goalY: 0,
                obstacles: [{x: 2, y: 0}], stars: [1, 4], gems: [3],
                validate: (r) => r.x === 5 && r.starsCollected >= 2 && r.gemsCollected >= 1 && !r.hitObstacle
            },
            
            // ===== WORLD 2: LOOPS (21-40) =====
            {
                id: 21, world: 2,
                title: "üîÑ for„É´„Éº„ÉóÂÖ•ÈñÄ",
                description: "<code>for</code>„É´„Éº„Éó„Åß3„Éû„ÇπÁßªÂãï!",
                initialCode: "// for (let i = 0; i < ÂõûÊï∞; i++) { }\n\n",
                hint: "for „ÅÆ‰∏≠„Å´ move() „ÇíÂÖ•„Çå„Çà„ÅÜ",
                goalX: 3, goalY: 0,
                obstacles: [], stars: [], gems: [],
                validate: (r) => r.x === 3 && r.y === 0
            },
            {
                id: 22, world: 2,
                title: "üîÑ 5„Éû„Çπ„É´„Éº„Éó",
                description: "for„É´„Éº„Éó„Åß5„Éû„ÇπÁßªÂãï„Åó„Çà„ÅÜ!",
                initialCode: "// 5Âõû„É´„Éº„Éó!\n\n",
                hint: "i < 5 „Åß„É´„Éº„Éó",
                goalX: 5, goalY: 0,
                obstacles: [], stars: [], gems: [],
                validate: (r) => r.x === 5 && r.y === 0
            },
            {
                id: 23, world: 2,
                title: "üîÅ while„É´„Éº„Éó",
                description: "<code>while (robot.x < 4)</code> „ÅßÁßªÂãï!",
                initialCode: "// while (Êù°‰ª∂) { }\n\n",
                hint: "robot.x < 4 „ÅÆÈñì„É´„Éº„Éó",
                goalX: 4, goalY: 0,
                obstacles: [], stars: [], gems: [],
                validate: (r) => r.x === 4 && r.y === 0
            },
            {
                id: 24, world: 2,
                title: "‚≠ê „É´„Éº„Éó„ÅßÊòü",
                description: "„É´„Éº„Éó„ÅßÁßªÂãï„Åó„Å¶Êòü„ÇíÈõÜ„ÇÅ„Çà„ÅÜ!",
                initialCode: "// „É´„Éº„Éó„ÅßÊòüÈõÜ„ÇÅ!\n\n",
                hint: "„É´„Éº„ÉóÂÜÖ„Åß move() „Å® collect()",
                goalX: 4, goalY: 0,
                obstacles: [], stars: [1, 2, 3], gems: [],
                validate: (r) => r.x === 4 && r.starsCollected >= 3
            },
            {
                id: 25, world: 2,
                title: "üî¢ Â§âÊï∞„Çí‰Ωø„Åä„ÅÜ",
                description: "<code>let steps = 3;</code> „Åß„É´„Éº„ÉóÂõûÊï∞„ÇíÊåáÂÆö!",
                initialCode: "let steps = 3;\n// steps „Çí‰Ωø„Å£„Å¶„É´„Éº„Éó!\n\n",
                hint: "for „ÅÆÊù°‰ª∂„Å´ steps „Çí‰Ωø„ÅÜ",
                goalX: 3, goalY: 0,
                obstacles: [], stars: [], gems: [],
                validate: (r) => r.x === 3 && r.y === 0
            },
            {
                id: 26, world: 2,
                title: "üß± „É´„Éº„Éó„Åß„Ç∏„É£„É≥„Éó",
                description: "ÈÄ£Á∂ö„Åó„ÅüÈöúÂÆ≥Áâ©„Çí„É´„Éº„Éó„Åß„Ç∏„É£„É≥„Éó!",
                initialCode: "// „É´„Éº„Éó„Åß„Ç∏„É£„É≥„Éó!\n\n",
                hint: "for „Åß jump() „ÇíÁπ∞„ÇäËøî„Åô",
                goalX: 3, goalY: 0,
                obstacles: [{x: 1, y: 0}, {x: 2, y: 0}], stars: [], gems: [],
                validate: (r) => r.x === 3 && !r.hitObstacle
            },
            {
                id: 27, world: 2,
                title: "üíé „É´„Éº„Éó„Åß„Ç∏„Çß„É†",
                description: "„É´„Éº„Éó„Åß„Ç∏„Çß„É†„ÇíÂÖ®ÈÉ®ÈõÜ„ÇÅ„Çà„ÅÜ!",
                initialCode: "// „Ç∏„Çß„É†„Çí„É´„Éº„Éó„Åß!\n\n",
                hint: "move() „Å® collectGem() „Çí„É´„Éº„Éó",
                goalX: 4, goalY: 0,
                obstacles: [], stars: [], gems: [1, 2, 3],
                validate: (r) => r.x === 4 && r.gemsCollected >= 3
            },
            {
                id: 28, world: 2,
                title: "‚¨ÜÔ∏è „É´„Éº„Éó„Åß‰∏äÊòá",
                description: "„É´„Éº„Éó„Åß‰∏ä„Å´3„Éû„ÇπÁßªÂãï!",
                initialCode: "// „É´„Éº„Éó„Åß‰∏ä„Å∏!\n\n",
                hint: "moveUp() „Çí„É´„Éº„Éó",
                goalX: 1, goalY: -3,
                obstacles: [], stars: [], gems: [],
                validate: (r) => r.x === 1 && r.y === -3
            },
            {
                id: 29, world: 2,
                title: "üîÄ 2„Å§„ÅÆ„É´„Éº„Éó",
                description: "Âè≥„Å´3„Éû„Çπ„ÄÅ‰∏ä„Å´2„Éû„Çπ!<br>2„Å§„ÅÆ„É´„Éº„Éó„Çí‰Ωø„Åä„ÅÜ„ÄÇ",
                initialCode: "// 2„Å§„ÅÆ„É´„Éº„Éó!\n\n",
                hint: "ÊúÄÂàù„ÅÆfor„ÅßÂè≥„ÄÅÊ¨°„ÅÆfor„Åß‰∏ä",
                goalX: 3, goalY: -2,
                obstacles: [], stars: [], gems: [],
                validate: (r) => r.x === 3 && r.y === -2
            },
            {
                id: 30, world: 2,
                title: "‚≠êüíé ‰∏°ÊñπÈõÜ„ÇÅ",
                description: "„É´„Éº„Éó„ÅßÊòü„Å®„Ç∏„Çß„É†„Çí‰∏°Êñπ!",
                initialCode: "// ‰∏°ÊñπÈõÜ„ÇÅ„Çà„ÅÜ!\n\n",
                hint: "collect() „Å® collectGem() „Çí‰∏°Êñπ„É´„Éº„ÉóÂÜÖ„Åß",
                goalX: 4, goalY: 0,
                obstacles: [], stars: [1, 2, 3], gems: [1, 2, 3],
                validate: (r) => r.x === 4 && r.starsCollected >= 3 && r.gemsCollected >= 3
            },
            {
                id: 31, world: 2,
                title: "üîÑ 6„Éû„Çπ„É´„Éº„Éó",
                description: "for„É´„Éº„Éó„Åß6„Éû„ÇπÁßªÂãï!",
                initialCode: "// 6Âõû„É´„Éº„Éó!\n\n",
                hint: "i < 6 „Åß„É´„Éº„Éó",
                goalX: 6, goalY: 0,
                obstacles: [], stars: [], gems: [],
                validate: (r) => r.x === 6 && r.y === 0
            },
            {
                id: 32, world: 2,
                title: "üåÄ while„ÅßÊòüÈõÜ„ÇÅ",
                description: "while„É´„Éº„Éó„ÅßÊòü„ÇíÈõÜ„ÇÅ„Å™„Åå„ÇâÈÄ≤„ÇÇ„ÅÜ!",
                initialCode: "// while„ÅßÊòüÈõÜ„ÇÅ!\n\n",
                hint: "while (robot.x < 5) „ÅßÊòü„ÇíÈõÜ„ÇÅ„Å™„Åå„Çâ",
                goalX: 5, goalY: 0,
                obstacles: [], stars: [1, 2, 3, 4], gems: [],
                validate: (r) => r.x === 5 && r.starsCollected >= 4
            },
            {
                id: 33, world: 2,
                title: "üß±üß±üß± 3„Å§„ÅÆÈöúÂÆ≥Áâ©",
                description: "3„Å§„ÅÆÈÄ£Á∂öÈöúÂÆ≥Áâ©„Çí„É´„Éº„Éó„Åß„Ç∏„É£„É≥„Éó!",
                initialCode: "// 3Âõû„Ç∏„É£„É≥„Éó!\n\n",
                hint: "for „Åß3Âõû jump()",
                goalX: 4, goalY: 0,
                obstacles: [{x: 1, y: 0}, {x: 2, y: 0}, {x: 3, y: 0}], stars: [], gems: [],
                validate: (r) => r.x === 4 && !r.hitObstacle
            },
            {
                id: 34, world: 2,
                title: "‚¨áÔ∏è „É´„Éº„Éó„Åß‰∏ãÈôç",
                description: "Âè≥„Å´2„Éû„Çπ„ÄÅ‰∏ã„Å´3„Éû„Çπ!",
                initialCode: "// Âè≥„Å®‰∏ã„ÅÆ„É´„Éº„Éó!\n\n",
                hint: "2„Å§„ÅÆforÊñá„Çí‰Ωø„Åä„ÅÜ",
                goalX: 2, goalY: 3,
                obstacles: [], stars: [], gems: [],
                validate: (r) => r.x === 2 && r.y === 3
            },
            {
                id: 35, world: 2,
                title: "üî¢ Â§âÊï∞„ÅßÊòü",
                description: "Â§âÊï∞ count „Åß‰ΩïÂÄãÈõÜ„ÇÅ„Åü„ÅãÊï∞„Åà„Çà„ÅÜ!",
                initialCode: "let count = 0;\n// „É´„Éº„Éó„ÅßÊï∞„Åà„Å™„Åå„ÇâÈõÜ„ÇÅ„Çà„ÅÜ!\n\n",
                hint: "collect() „ÅÆÂæå„Å´ count++ „ÅßÊï∞„Åà„Çã",
                goalX: 4, goalY: 0,
                obstacles: [], stars: [1, 2, 3], gems: [],
                validate: (r) => r.x === 4 && r.starsCollected >= 3
            },
            {
                id: 36, world: 2,
                title: "üîÅ whileÊù°‰ª∂",
                description: "Êòü„Åå3ÂÄã„Å´„Å™„Çã„Åæ„ÅßÈÄ≤„ÇÇ„ÅÜ!",
                initialCode: "// while (robot.starsCollected < 3)\n\n",
                hint: "starsCollected „Çí„ÉÅ„Çß„ÉÉ„ÇØ",
                goalX: 5, goalY: 0,
                obstacles: [], stars: [1, 3, 5], gems: [],
                validate: (r) => r.starsCollected >= 3
            },
            {
                id: 37, world: 2,
                title: "üíéüíéüíéüíé 4„Å§„ÅÆ„Ç∏„Çß„É†",
                description: "4„Å§„ÅÆ„Ç∏„Çß„É†„Çí„É´„Éº„Éó„Åß!",
                initialCode: "// 4„Å§ÈõÜ„ÇÅ„Çà„ÅÜ!\n\n",
                hint: "4Âõû„É´„Éº„Éó„Åß collectGem()",
                goalX: 5, goalY: 0,
                obstacles: [], stars: [], gems: [1, 2, 3, 4],
                validate: (r) => r.x === 5 && r.gemsCollected >= 4
            },
            {
                id: 38, world: 2,
                title: "üìê ÂõõËßíÂΩ¢„Éë„Çπ",
                description: "Âè≥„Å´2„Éû„Çπ„ÄÅ‰∏ä„Å´2„Éû„ÇπÈÄ≤„ÇÇ„ÅÜ!",
                initialCode: "// ÂõõËßíÂΩ¢„ÅÆËßí„Å∏!\n\n",
                hint: "2„Å§„ÅÆforÊñá„ÅßÂè≥„Å®‰∏ä",
                goalX: 2, goalY: -2,
                obstacles: [], stars: [], gems: [],
                validate: (r) => r.x === 2 && r.y === -2
            },
            {
                id: 39, world: 2,
                title: "‚≠ê 5„Å§„ÅÆÊòü",
                description: "5„Å§„ÅÆÊòü„ÇíÂÖ®ÈÉ®ÈõÜ„ÇÅ„Çà„ÅÜ!",
                initialCode: "// 5„Å§ÂÖ®ÈÉ®!\n\n",
                hint: "5Âõû„É´„Éº„Éó„Åß move() „Å® collect()",
                goalX: 6, goalY: 0,
                obstacles: [], stars: [1, 2, 3, 4, 5], gems: [],
                validate: (r) => r.x === 6 && r.starsCollected >= 5
            },
            {
                id: 40, world: 2,
                title: "üèÜ „É´„Éº„Éó„Éû„Çπ„Çø„Éº",
                description: "„É´„Éº„Éó„ÇíÈßÜ‰Ωø„Åó„Å¶ÂÖ®ÈÉ®ÈõÜ„ÇÅ„Çà„ÅÜ!",
                initialCode: "// „É´„Éº„Éó„ÅÆÈõÜÂ§ßÊàê!\n\n",
                hint: "forÊñá„ÅßÈöúÂÆ≥Áâ©„ÇíÈÅø„Åë„Å™„Åå„ÇâÊòü„Å®„Ç∏„Çß„É†„Çí",
                goalX: 7, goalY: 0,
                obstacles: [{x: 3, y: 0}], stars: [1, 2, 5, 6], gems: [4],
                validate: (r) => r.x === 7 && r.starsCollected >= 4 && r.gemsCollected >= 1 && !r.hitObstacle
            },
            
            // ===== WORLD 3: CONDITIONS (41-60) =====
            {
                id: 41, world: 3,
                title: "‚ùì ifÊñáÂÖ•ÈñÄ",
                description: "<code>if (robot.isObstacle())</code> „ÅßÈöúÂÆ≥Áâ©„ÉÅ„Çß„ÉÉ„ÇØ!",
                initialCode: "// if „ÅßÈöúÂÆ≥Áâ©„Çí„ÉÅ„Çß„ÉÉ„ÇØ!\nfor (let i = 0; i < 3; i++) {\n  // „Åì„Åì„Å´ifÊñá\n}\n",
                hint: "isObstacle() „Åå true „Å™„Çâ jump()",
                goalX: 3, goalY: 0,
                obstacles: [{x: 1, y: 0}], stars: [], gems: [],
                validate: (r) => r.x === 3 && !r.hitObstacle
            },
            {
                id: 42, world: 3,
                title: "üîÄ if-else",
                description: "ÈöúÂÆ≥Áâ©„Åå„ÅÇ„Çå„Å∞ jump„ÄÅ„Å™„Åë„Çå„Å∞ move!",
                initialCode: "// if-else „Çí‰Ωø„Åä„ÅÜ!\nfor (let i = 0; i < 4; i++) {\n  \n}\n",
                hint: "if (ÈöúÂÆ≥Áâ©) { jump } else { move }",
                goalX: 4, goalY: 0,
                obstacles: [{x: 2, y: 0}], stars: [], gems: [],
                validate: (r) => r.x === 4 && !r.hitObstacle
            },
            {
                id: 43, world: 3,
                title: "‚≠ê Êòü„ÉÅ„Çß„ÉÉ„ÇØ",
                description: "<code>robot.isStar()</code> „ÅßÊòü„Çí„ÉÅ„Çß„ÉÉ„ÇØ!",
                initialCode: "// Êòü„Åå„ÅÇ„Çã„Å®„Åç„Å†„Åë collect!\n\n",
                hint: "if (robot.isStar()) { collect() }",
                goalX: 4, goalY: 0,
                obstacles: [], stars: [2, 4], gems: [],
                validate: (r) => r.x === 4 && r.starsCollected >= 2
            },
            {
                id: 44, world: 3,
                title: "üíé „Ç∏„Çß„É†„ÉÅ„Çß„ÉÉ„ÇØ",
                description: "<code>robot.isGem()</code> „Åß„Ç∏„Çß„É†„Çí„ÉÅ„Çß„ÉÉ„ÇØ!",
                initialCode: "// „Ç∏„Çß„É†„Åå„ÅÇ„Çã„Å®„Åç„Å†„Åë collectGem!\n\n",
                hint: "if (robot.isGem()) { collectGem() }",
                goalX: 4, goalY: 0,
                obstacles: [], stars: [], gems: [1, 3],
                validate: (r) => r.x === 4 && r.gemsCollected >= 2
            },
            {
                id: 45, world: 3,
                title: "üîÄ else if",
                description: "Ë§áÊï∞„ÅÆÊù°‰ª∂„Çí else if „ÅßÂá¶ÁêÜ!",
                initialCode: "// if, else if, else „Çí‰Ωø„Åä„ÅÜ!\n\n",
                hint: "ÈöúÂÆ≥Áâ©‚ÜíÊòü‚ÜíÁßªÂãï „ÅÆÈ†Ü„Åß„ÉÅ„Çß„ÉÉ„ÇØ",
                goalX: 5, goalY: 0,
                obstacles: [{x: 2, y: 0}], stars: [1, 4], gems: [],
                validate: (r) => r.x === 5 && r.starsCollected >= 2 && !r.hitObstacle
            },
            {
                id: 46, world: 3,
                title: "üéØ „Ç¥„Éº„É´„ÉÅ„Çß„ÉÉ„ÇØ",
                description: "<code>robot.isGoal()</code> „Åß„Ç¥„Éº„É´„ÇíÊ§úÁü•!",
                initialCode: "// „Ç¥„Éº„É´„Åæ„ÅßÈÄ≤„ÇÇ„ÅÜ!\n\n",
                hint: "while (!robot.isGoal()) „Åß„É´„Éº„Éó",
                goalX: 5, goalY: 0,
                obstacles: [], stars: [], gems: [],
                validate: (r) => r.x === 5
            },
            {
                id: 47, world: 3,
                title: "üß† ANDÊºîÁÆóÂ≠ê",
                description: "<code>&&</code> „ÅßË§áÊï∞Êù°‰ª∂„Çí„ÉÅ„Çß„ÉÉ„ÇØ!",
                initialCode: "// && „ÅØ„Äå„Åã„Å§„Äç\n\n",
                hint: "Êù°‰ª∂A && Êù°‰ª∂B „Åß‰∏°Êñπ„ÉÅ„Çß„ÉÉ„ÇØ",
                goalX: 5, goalY: 0,
                obstacles: [], stars: [1, 2, 3, 4], gems: [],
                validate: (r) => r.x === 5 && r.starsCollected >= 4
            },
            {
                id: 48, world: 3,
                title: "üß† ORÊºîÁÆóÂ≠ê",
                description: "<code>||</code> „Åß„Å©„Å°„Çâ„Åã„ÅÆÊù°‰ª∂!",
                initialCode: "// || „ÅØ„Äå„Åæ„Åü„ÅØ„Äç\n\n",
                hint: "Êòü„Åæ„Åü„ÅØ„Ç∏„Çß„É†„Åå„ÅÇ„Çå„Å∞ÂèéÈõÜ",
                goalX: 5, goalY: 0,
                obstacles: [], stars: [1, 3], gems: [2, 4],
                validate: (r) => r.x === 5 && r.starsCollected >= 2 && r.gemsCollected >= 2
            },
            {
                id: 49, world: 3,
                title: "üö´ NOTÊºîÁÆóÂ≠ê",
                description: "<code>!</code> „ÅßÊù°‰ª∂„ÇíÂèçËª¢!",
                initialCode: "// ! „ÅØ„Äå„Åß„Å™„ÅÑ„Äç\n\n",
                hint: "!robot.isObstacle() = ÈöúÂÆ≥Áâ©„Åå„Å™„ÅÑ",
                goalX: 4, goalY: 0,
                obstacles: [{x: 2, y: 0}], stars: [], gems: [],
                validate: (r) => r.x === 4 && !r.hitObstacle
            },
            {
                id: 50, world: 3,
                title: "üîÑ Êù°‰ª∂‰ªò„Åç„É´„Éº„Éó",
                description: "Êù°‰ª∂„ÇíÊ∫Ä„Åü„ÅôÈñì„É´„Éº„Éó„Åó„Çà„ÅÜ!",
                initialCode: "// while „Å® if „ÅÆÁµÑ„ÅøÂêà„Çè„Åõ!\n\n",
                hint: "while „Åß„É´„Éº„Éó„ÄÅ‰∏≠„Åß if „ÅßÂàÜÂ≤ê",
                goalX: 6, goalY: 0,
                obstacles: [{x: 2, y: 0}, {x: 4, y: 0}], stars: [], gems: [],
                validate: (r) => r.x === 6 && !r.hitObstacle
            },
            {
                id: 51, world: 3,
                title: "‚≠êüíé ‰∏°Êñπ„ÉÅ„Çß„ÉÉ„ÇØ",
                description: "Êòü„Å®„Ç∏„Çß„É†„ÄÅ„Åù„Çå„Åû„Çå„ÅÆÊù°‰ª∂„ÅßÂèéÈõÜ!",
                initialCode: "// ‰∏°Êñπ„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Çà„ÅÜ!\n\n",
                hint: "if (isStar) „Å® if (isGem) „ÇíÂà•„ÄÖ„Å´",
                goalX: 5, goalY: 0,
                obstacles: [], stars: [1, 3], gems: [2, 4],
                validate: (r) => r.x === 5 && r.starsCollected >= 2 && r.gemsCollected >= 2
            },
            {
                id: 52, world: 3,
                title: "üß±‚≠ê ÈöúÂÆ≥Áâ©„Å®Êòü",
                description: "ÈöúÂÆ≥Áâ©„ÇíÈÅø„Åë„Å§„Å§Êòü„ÇíÈõÜ„ÇÅ„Çà„ÅÜ!",
                initialCode: "// ‰∏°Êñπ„Å´ÂØæÂøú!\n\n",
                hint: "„Åæ„ÅöÈöúÂÆ≥Áâ©„ÉÅ„Çß„ÉÉ„ÇØ„ÄÅÊ¨°„Å´Êòü„ÉÅ„Çß„ÉÉ„ÇØ",
                goalX: 6, goalY: 0,
                obstacles: [{x: 2, y: 0}], stars: [1, 4, 5], gems: [],
                validate: (r) => r.x === 6 && r.starsCollected >= 3 && !r.hitObstacle
            },
            {
                id: 53, world: 3,
                title: "üî¢ „Ç´„Ç¶„É≥„ÉàÊù°‰ª∂",
                description: "Êòü„Çí3ÂÄãÈõÜ„ÇÅ„Çã„Åæ„ÅßÈÄ≤„ÇÇ„ÅÜ!",
                initialCode: "// starsCollected „ÅßÊù°‰ª∂!\n\n",
                hint: "while (robot.starsCollected < 3)",
                goalX: 6, goalY: 0,
                obstacles: [], stars: [1, 3, 5], gems: [],
                validate: (r) => r.starsCollected >= 3
            },
            {
                id: 54, world: 3,
                title: "üìç ‰ΩçÁΩÆÊù°‰ª∂",
                description: "robot.x „Çí‰Ωø„Å£„Å¶Êù°‰ª∂ÂàÜÂ≤ê!",
                initialCode: "// ‰ΩçÁΩÆ„ÅßÊù°‰ª∂„ÇíÂ§â„Åà„Çà„ÅÜ!\n\n",
                hint: "if (robot.x === 2) „Å™„Å©„Åß‰ΩçÁΩÆ„ÉÅ„Çß„ÉÉ„ÇØ",
                goalX: 5, goalY: 0,
                obstacles: [], stars: [2], gems: [4],
                validate: (r) => r.x === 5 && r.starsCollected >= 1 && r.gemsCollected >= 1
            },
            {
                id: 55, world: 3,
                title: "üîÄ Ë§áÂêàÊù°‰ª∂",
                description: "Ë§áÊï∞„ÅÆÊù°‰ª∂„ÇíÁµÑ„ÅøÂêà„Çè„Åõ„Çà„ÅÜ!",
                initialCode: "// && „Å® || „ÇíÁµÑ„ÅøÂêà„Çè„Åõ!\n\n",
                hint: "(Êù°‰ª∂A && Êù°‰ª∂B) || Êù°‰ª∂C",
                goalX: 6, goalY: 0,
                obstacles: [{x: 3, y: 0}], stars: [1, 2, 5], gems: [4],
                validate: (r) => r.x === 6 && r.starsCollected >= 3 && r.gemsCollected >= 1 && !r.hitObstacle
            },
            {
                id: 56, world: 3,
                title: "üéØ „Ç¥„Éº„É´„Åæ„ÅßÂèéÈõÜ",
                description: "„Ç¥„Éº„É´„Åæ„ÅßÂÖ®ÈÉ®ÈõÜ„ÇÅ„Çà„ÅÜ!",
                initialCode: "// isGoal() „Åæ„ÅßÂèéÈõÜ!\n\n",
                hint: "while (!isGoal()) „ÅßÂèéÈõÜ„Åó„Å™„Åå„Çâ",
                goalX: 6, goalY: 0,
                obstacles: [], stars: [1, 2, 3, 4, 5], gems: [],
                validate: (r) => r.x === 6 && r.starsCollected >= 5
            },
            {
                id: 57, world: 3,
                title: "üß±üß± 2ÈöúÂÆ≥Áâ©Êù°‰ª∂",
                description: "2„Å§„ÅÆÈöúÂÆ≥Áâ©„ÇíÊù°‰ª∂„ÅßÈÅø„Åë„Çà„ÅÜ!",
                initialCode: "// Êù°‰ª∂„ÅßÈöúÂÆ≥Áâ©ÂØæÂøú!\n\n",
                hint: "„É´„Éº„ÉóÂÜÖ„Åß isObstacle() „ÉÅ„Çß„ÉÉ„ÇØ",
                goalX: 5, goalY: 0,
                obstacles: [{x: 1, y: 0}, {x: 3, y: 0}], stars: [], gems: [],
                validate: (r) => r.x === 5 && !r.hitObstacle
            },
            {
                id: 58, world: 3,
                title: "‚≠ê‚≠ê‚≠ê‚≠ê 4„Å§„ÅÆÊòü",
                description: "Êù°‰ª∂‰ªò„Åç„Åß4„Å§„ÅÆÊòü„ÇíÈõÜ„ÇÅ„Çà„ÅÜ!",
                initialCode: "// 4„Å§ÂÖ®ÈÉ®!\n\n",
                hint: "if (isStar()) „ÅßÊòü„Åå„ÅÇ„ÇãÊôÇ„Å†„Åë collect",
                goalX: 6, goalY: 0,
                obstacles: [], stars: [1, 2, 4, 5], gems: [],
                validate: (r) => r.x === 6 && r.starsCollected >= 4
            },
            {
                id: 59, world: 3,
                title: "üåÄ „Éç„Çπ„ÉàÊù°‰ª∂",
                description: "if „ÅÆ‰∏≠„Å´ if „ÇíÂÖ•„Çå„Çà„ÅÜ!",
                initialCode: "// „Éç„Çπ„Éà„Åó„ÅüÊù°‰ª∂!\n\n",
                hint: "if (Êù°‰ª∂A) { if (Êù°‰ª∂B) { ... } }",
                goalX: 5, goalY: 0,
                obstacles: [{x: 2, y: 0}], stars: [3, 4], gems: [],
                validate: (r) => r.x === 5 && r.starsCollected >= 2 && !r.hitObstacle
            },
            {
                id: 60, world: 3,
                title: "üèÜ Êù°‰ª∂„Éû„Çπ„Çø„Éº",
                description: "ÂÖ®„Å¶„ÅÆÊù°‰ª∂ÊäÄË°ì„Çí‰Ωø„Åä„ÅÜ!",
                initialCode: "// Êù°‰ª∂„ÅÆÈõÜÂ§ßÊàê!\n\n",
                hint: "while, if, else, &&, || „ÇíÂÖ®ÈÉ®‰Ωø„Åä„ÅÜ",
                goalX: 8, goalY: 0,
                obstacles: [{x: 2, y: 0}, {x: 5, y: 0}], stars: [1, 3, 4, 6, 7], gems: [4],
                validate: (r) => r.x === 8 && r.starsCollected >= 5 && r.gemsCollected >= 1 && !r.hitObstacle
            },
            
            // ===== WORLD 4: FUNCTIONS (61-80) =====
            {
                id: 61, world: 4,
                title: "‚öôÔ∏è Èñ¢Êï∞ÂÖ•ÈñÄ",
                description: "<code>function ÂêçÂâç() { }</code> „ÅßÈñ¢Êï∞„Çí‰Ωú„Çç„ÅÜ!",
                initialCode: "// Èñ¢Êï∞„Çí‰Ωú„Å£„Å¶Âëº„Å≥Âá∫„Åù„ÅÜ!\nfunction moveOnce() {\n  robot.move();\n}\n\n// 3ÂõûÂëº„Å≥Âá∫„Åó„Å¶„Ç¥„Éº„É´„Å∏\n",
                hint: "Èñ¢Êï∞„ÇíÂÆöÁæ©„Åó„Å¶„ÄÅË§áÊï∞ÂõûÂëº„Å≥Âá∫„Åô",
                goalX: 3, goalY: 0,
                obstacles: [], stars: [], gems: [],
                validate: (r) => r.x === 3 && r.y === 0
            },
            {
                id: 62, world: 4,
                title: "‚öôÔ∏è moveTwoÈñ¢Êï∞",
                description: "2„Éû„ÇπÁßªÂãï„Åô„ÇãÈñ¢Êï∞„Çí‰Ωú„Çç„ÅÜ!",
                initialCode: "function moveTwo() {\n  // 2„Éû„ÇπÁßªÂãï„Åô„ÇãÈñ¢Êï∞\n}\n\n// Âëº„Å≥Âá∫„Åó„Å¶4„Éû„ÇπÈÄ≤„ÇÇ„ÅÜ\n",
                hint: "Èñ¢Êï∞ÂÜÖ„Å´ move() „Çí2ÂõûÊõ∏„Åè",
                goalX: 4, goalY: 0,
                obstacles: [], stars: [], gems: [],
                validate: (r) => r.x === 4 && r.y === 0
            },
            {
                id: 63, world: 4,
                title: "üì¶ ÂºïÊï∞ÂÖ•ÈñÄ",
                description: "<code>function move(n)</code> „ÅßÂºïÊï∞„Çí‰Ωø„Åä„ÅÜ!",
                initialCode: "function moveN(n) {\n  // nÂõûÁßªÂãï„Åô„ÇãÈñ¢Êï∞\n}\n\n// moveN(4) „Åß4„Éû„ÇπÈÄ≤„ÇÇ„ÅÜ\n",
                hint: "Èñ¢Êï∞ÂÜÖ„Åß for „É´„Éº„Éó„Å®ÂºïÊï∞ n „Çí‰Ωø„ÅÜ",
                goalX: 4, goalY: 0,
                obstacles: [], stars: [], gems: [],
                validate: (r) => r.x === 4 && r.y === 0
            },
            {
                id: 64, world: 4,
                title: "‚≠ê ÂèéÈõÜÈñ¢Êï∞",
                description: "ÁßªÂãï„Åó„Å¶ÂèéÈõÜ„Åô„ÇãÈñ¢Êï∞„Çí‰Ωú„Çç„ÅÜ!",
                initialCode: "function moveAndCollect() {\n  // ÁßªÂãï„Åó„Å¶ÂèéÈõÜ\n}\n\n// 3ÂõûÂëº„Å≥Âá∫„Åù„ÅÜ\n",
                hint: "Èñ¢Êï∞ÂÜÖ„Åß move() „Å® collect()",
                goalX: 3, goalY: 0,
                obstacles: [], stars: [1, 2, 3], gems: [],
                validate: (r) => r.x === 3 && r.starsCollected >= 3
            },
            {
                id: 65, world: 4,
                title: "üß± „Ç∏„É£„É≥„ÉóÈñ¢Êï∞",
                description: "ÈöúÂÆ≥Áâ©Âá¶ÁêÜ„ÇíÈñ¢Êï∞„Å´„Åó„Çà„ÅÜ!",
                initialCode: "function handleMove() {\n  // ÈöúÂÆ≥Áâ©„Åå„ÅÇ„Çå„Å∞„Ç∏„É£„É≥„Éó\n}\n\n// 4ÂõûÂëº„Å≥Âá∫„Åù„ÅÜ\n",
                hint: "if (isObstacle()) „ÇíÈñ¢Êï∞ÂÜÖ„Å´",
                goalX: 4, goalY: 0,
                obstacles: [{x: 2, y: 0}], stars: [], gems: [],
                validate: (r) => r.x === 4 && !r.hitObstacle
            },
            {
                id: 66, world: 4,
                title: "üîô returnÂÖ•ÈñÄ",
                description: "<code>return</code> „ÅßÂÄ§„ÇíËøî„Åù„ÅÜ!",
                initialCode: "function getX() {\n  return robot.x;\n}\n\n// Èñ¢Êï∞„Çí‰Ωø„Å£„Å¶ÁßªÂãï\nwhile (getX() < 4) {\n  robot.move();\n}\n",
                hint: "return „ÅßÁèæÂú®‰ΩçÁΩÆ„ÇíËøî„Åô",
                goalX: 4, goalY: 0,
                obstacles: [], stars: [], gems: [],
                validate: (r) => r.x === 4
            },
            {
                id: 67, world: 4,
                title: "üî¢ „Ç´„Ç¶„É≥„ÉàÈñ¢Êï∞",
                description: "ÂèéÈõÜ„Åó„ÅüÊï∞„ÇíËøî„ÅôÈñ¢Êï∞„Çí‰Ωú„Çç„ÅÜ!",
                initialCode: "function collectAndCount() {\n  robot.move();\n  robot.collect();\n  return robot.starsCollected;\n}\n\n// 3ÂõûÂëº„Å≥Âá∫„Åù„ÅÜ\n",
                hint: "collect() Âæå„Å´ starsCollected „Çí return",
                goalX: 3, goalY: 0,
                obstacles: [], stars: [1, 2, 3], gems: [],
                validate: (r) => r.x === 3 && r.starsCollected >= 3
            },
            {
                id: 68, world: 4,
                title: "‚öôÔ∏è‚öôÔ∏è 2„Å§„ÅÆÈñ¢Êï∞",
                description: "2„Å§„ÅÆÈñ¢Êï∞„ÇíÁµÑ„ÅøÂêà„Çè„Åõ„Çà„ÅÜ!",
                initialCode: "function goRight() {\n  robot.move();\n}\n\nfunction goUp() {\n  robot.moveUp();\n}\n\n// ÁµÑ„ÅøÂêà„Çè„Åõ„Å¶‰Ωø„Åä„ÅÜ\n",
                hint: "„Åù„Çå„Åû„Çå„ÅÆÈñ¢Êï∞„ÇíÈÅ©Âàá„Å´Âëº„Å≥Âá∫„Åô",
                goalX: 2, goalY: -2,
                obstacles: [], stars: [], gems: [],
                validate: (r) => r.x === 2 && r.y === -2
            },
            {
                id: 69, world: 4,
                title: "üì¶ Ë§áÊï∞ÂºïÊï∞",
                description: "ÂºïÊï∞„Çí2„Å§‰Ωø„ÅÜÈñ¢Êï∞„Çí‰Ωú„Çç„ÅÜ!",
                initialCode: "function moveXY(x, y) {\n  // xÂõûÂè≥„ÄÅyÂõû‰∏ä„Å´ÁßªÂãï\n}\n\n// moveXY(3, 2) „ÅßÁßªÂãï\n",
                hint: "forÊñá„Çí2„Å§‰Ωø„Å£„Å¶ x „Å® y ÂõûÁßªÂãï",
                goalX: 3, goalY: -2,
                obstacles: [], stars: [], gems: [],
                validate: (r) => r.x === 3 && r.y === -2
            },
            {
                id: 70, world: 4,
                title: "üéØ Êù°‰ª∂‰ªò„ÅçÈñ¢Êï∞",
                description: "Êù°‰ª∂ÂàÜÂ≤ê„ÇíÂê´„ÇÄÈñ¢Êï∞„Çí‰Ωú„Çç„ÅÜ!",
                initialCode: "function smartMove() {\n  // ÈöúÂÆ≥Áâ©„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Å¶ÁßªÂãï\n}\n\n// „É´„Éº„Éó„ÅßÂëº„Å≥Âá∫„Åù„ÅÜ\n",
                hint: "if (isObstacle()) „ÇíÈñ¢Êï∞ÂÜÖ„Å´",
                goalX: 5, goalY: 0,
                obstacles: [{x: 2, y: 0}, {x: 4, y: 0}], stars: [], gems: [],
                validate: (r) => r.x === 5 && !r.hitObstacle
            },
            {
                id: 71, world: 4,
                title: "‚≠ê ÂèéÈõÜ„ÉÅ„Çß„ÉÉ„ÇØÈñ¢Êï∞",
                description: "Êòü„Åå„ÅÇ„Çå„Å∞ÂèéÈõÜ„Åô„ÇãÈñ¢Êï∞„Çí‰Ωú„Çç„ÅÜ!",
                initialCode: "function tryCollect() {\n  // Êòü„Åå„ÅÇ„Çå„Å∞ÂèéÈõÜ\n}\n\n// ÁßªÂãï„Åó„Å™„Åå„ÇâÂëº„Å≥Âá∫„Åù„ÅÜ\n",
                hint: "if (isStar()) { collect() } „ÇíÈñ¢Êï∞„Å´",
                goalX: 5, goalY: 0,
                obstacles: [], stars: [1, 3, 5], gems: [],
                validate: (r) => r.x === 5 && r.starsCollected >= 3
            },
            {
                id: 72, world: 4,
                title: "üíé „Ç∏„Çß„É†ÂèéÈõÜÈñ¢Êï∞",
                description: "„Ç∏„Çß„É†„ÉÅ„Çß„ÉÉ„ÇØÈñ¢Êï∞„Çí‰Ωú„Çç„ÅÜ!",
                initialCode: "function tryCollectGem() {\n  // „Ç∏„Çß„É†„Åå„ÅÇ„Çå„Å∞ÂèéÈõÜ\n}\n\n",
                hint: "if (isGem()) { collectGem() }",
                goalX: 5, goalY: 0,
                obstacles: [], stars: [], gems: [1, 2, 4],
                validate: (r) => r.x === 5 && r.gemsCollected >= 3
            },
            {
                id: 73, world: 4,
                title: "üîÄ ÂàÜÂ≤êÈñ¢Êï∞",
                description: "Ë§áÊï∞„ÅÆÂàÜÂ≤ê„ÇíÂê´„ÇÄÈñ¢Êï∞„Çí‰Ωú„Çç„ÅÜ!",
                initialCode: "function step() {\n  // ÈöúÂÆ≥Áâ©„ÄÅÊòü„ÄÅ„Ç∏„Çß„É†„Çí„ÉÅ„Çß„ÉÉ„ÇØ\n}\n\n",
                hint: "if-else if-else „ÅßÂÖ®„Ç±„Éº„ÇπÂØæÂøú",
                goalX: 5, goalY: 0,
                obstacles: [{x: 2, y: 0}], stars: [1, 4], gems: [3],
                validate: (r) => r.x === 5 && r.starsCollected >= 2 && r.gemsCollected >= 1 && !r.hitObstacle
            },
            {
                id: 74, world: 4,
                title: "üîÅ „É´„Éº„ÉóÈñ¢Êï∞",
                description: "„É´„Éº„Éó„ÇíÂê´„ÇÄÈñ¢Êï∞„Çí‰Ωú„Çç„ÅÜ!",
                initialCode: "function moveMany(n) {\n  // nÂõûÁßªÂãï\n}\n\n// moveMany(5) „Åß5„Éû„Çπ\n",
                hint: "for (let i = 0; i < n; i++) „ÇíÈñ¢Êï∞ÂÜÖ„Å´",
                goalX: 5, goalY: 0,
                obstacles: [], stars: [], gems: [],
                validate: (r) => r.x === 5 && r.y === 0
            },
            {
                id: 75, world: 4,
                title: "üîô boolÈñ¢Êï∞",
                description: "true/false „ÇíËøî„ÅôÈñ¢Êï∞„Çí‰Ωú„Çç„ÅÜ!",
                initialCode: "function canCollect() {\n  return robot.isStar() || robot.isGem();\n}\n\n// canCollect() „Çí‰Ωø„Åä„ÅÜ\n",
                hint: "|| „ÅßÊòü„Åæ„Åü„ÅØ„Ç∏„Çß„É†„Çí„ÉÅ„Çß„ÉÉ„ÇØ",
                goalX: 5, goalY: 0,
                obstacles: [], stars: [1, 3], gems: [2, 4],
                validate: (r) => r.x === 5 && r.starsCollected >= 2 && r.gemsCollected >= 2
            },
            {
                id: 76, world: 4,
                title: "‚öôÔ∏è‚öôÔ∏è‚öôÔ∏è 3„Å§„ÅÆÈñ¢Êï∞",
                description: "3„Å§„ÅÆÈñ¢Êï∞„ÇíÈÄ£Êê∫„Åï„Åõ„Çà„ÅÜ!",
                initialCode: "function handleObstacle() { }\nfunction collectStar() { }\nfunction collectGem() { }\n\n// ÁµÑ„ÅøÂêà„Çè„Åõ„Å¶‰Ωø„Åä„ÅÜ\n",
                hint: "ÂêÑÈñ¢Êï∞„Å´ÈÅ©Âàá„Å™Âá¶ÁêÜ„ÇíÊõ∏„Åè",
                goalX: 6, goalY: 0,
                obstacles: [{x: 2, y: 0}], stars: [1, 4, 5], gems: [3],
                validate: (r) => r.x === 6 && r.starsCollected >= 3 && r.gemsCollected >= 1 && !r.hitObstacle
            },
            {
                id: 77, world: 4,
                title: "üéØ „Ç¥„Éº„É´Èñ¢Êï∞",
                description: "„Ç¥„Éº„É´„Åæ„ÅßÈÄ≤„ÇÄÈñ¢Êï∞„Çí‰Ωú„Çç„ÅÜ!",
                initialCode: "function goToGoal() {\n  // isGoal() „Åæ„Åß„É´„Éº„Éó\n}\n\ngoToGoal();\n",
                hint: "while (!isGoal()) „ÇíÈñ¢Êï∞ÂÜÖ„Å´",
                goalX: 6, goalY: 0,
                obstacles: [], stars: [], gems: [],
                validate: (r) => r.x === 6
            },
            {
                id: 78, world: 4,
                title: "üåÄ ÂÜçÂ∏∞ÁöÑÊÄùËÄÉ",
                description: "Èñ¢Êï∞„Åã„ÇâÈñ¢Êï∞„ÇíÂëº„Å≥Âá∫„Åù„ÅÜ!",
                initialCode: "function step() {\n  // 1Ê≠©ÈÄ≤„ÇÄ\n}\n\nfunction run() {\n  // step() „ÇíÁπ∞„ÇäËøî„ÅóÂëº„Å∂\n}\n\nrun();\n",
                hint: "run() ÂÜÖ„Åß for „É´„Éº„Éó„Åß step() „ÇíÂëº„Å∂",
                goalX: 5, goalY: 0,
                obstacles: [{x: 2, y: 0}], stars: [1, 3, 4], gems: [],
                validate: (r) => r.x === 5 && r.starsCollected >= 3 && !r.hitObstacle
            },
            {
                id: 79, world: 4,
                title: "üìä Áµ±Ë®àÈñ¢Êï∞",
                description: "ÂèéÈõÜÊï∞„ÅÆÂêàË®à„ÇíËøî„ÅôÈñ¢Êï∞!",
                initialCode: "function getTotal() {\n  return robot.starsCollected + robot.gemsCollected;\n}\n\n// getTotal() „Çí‰Ωø„Åä„ÅÜ\n",
                hint: "Êòü„Å®„Ç∏„Çß„É†„ÅÆÂêàË®à„Çí return",
                goalX: 5, goalY: 0,
                obstacles: [], stars: [1, 2, 3], gems: [4],
                validate: (r) => r.x === 5 && r.starsCollected >= 3 && r.gemsCollected >= 1
            },
            {
                id: 80, world: 4,
                title: "üèÜ „Éû„Çπ„Çø„Éº„ÉÅ„É£„É¨„É≥„Ç∏",
                description: "ÂÖ®ÊäÄË°ì„Çí‰Ωø„Å£„Å¶„Ç¥„Éº„É´„Å∏!",
                initialCode: "// ÊúÄÁµÇ„ÉÅ„É£„É¨„É≥„Ç∏!\n// Èñ¢Êï∞„ÄÅ„É´„Éº„Éó„ÄÅÊù°‰ª∂„ÇíÂÖ®ÈÉ®‰Ωø„Åä„ÅÜ!\n\n",
                hint: "smartMove, collectAll Èñ¢Êï∞„Çí‰Ωú„Çä„ÄÅwhile„Åß„Ç¥„Éº„É´„Åæ„Åß",
                goalX: 9, goalY: 0,
                obstacles: [{x: 2, y: 0}, {x: 4, y: 0}, {x: 7, y: 0}], 
                stars: [1, 3, 5, 6, 8], gems: [3, 6, 9],
                validate: (r) => r.x === 9 && r.starsCollected >= 5 && r.gemsCollected >= 3 && !r.hitObstacle
            }
        ];

        // ===== ROBOT CLASS =====
        class Robot {
            constructor() {
                this.reset();
            }

            reset() {
                this.x = 0;
                this.y = 0;
                this.starsCollected = 0;
                this.gemsCollected = 0;
                this.hitObstacle = false;
                this.moves = [];
                this.currentLevel = null;
                this.eyeState = 'normal';
                this.antennaGlow = 0;
            }

            setLevel(level) {
                this.currentLevel = level;
            }

            move() {
                const nextX = this.x + 1;
                if (this.checkObstacleAt(nextX, this.y)) {
                    this.hitObstacle = true;
                    log('üí• ÈöúÂÆ≥Áâ©„Å´„Å∂„Å§„Åã„Å£„Åü!');
                    return;
                }
                this.moves.push({ type: 'move', fromX: this.x, fromY: this.y, toX: nextX, toY: this.y });
                this.x = nextX;
                log(`ü§ñ ÁßªÂãï ‚Üí (${this.x}, ${this.y})`);
            }

            moveUp() {
                const nextY = this.y - 1;
                this.moves.push({ type: 'moveUp', fromX: this.x, fromY: this.y, toX: this.x, toY: nextY });
                this.y = nextY;
                log(`ü§ñ ‰∏ä„Å∏ÁßªÂãï ‚Üë (${this.x}, ${this.y})`);
            }

            moveDown() {
                const nextY = this.y + 1;
                this.moves.push({ type: 'moveDown', fromX: this.x, fromY: this.y, toX: this.x, toY: nextY });
                this.y = nextY;
                log(`ü§ñ ‰∏ã„Å∏ÁßªÂãï ‚Üì (${this.x}, ${this.y})`);
            }

            jump() {
                const nextX = this.x + 1;
                this.moves.push({ type: 'jump', fromX: this.x, fromY: this.y, toX: nextX, toY: this.y });
                this.x = nextX;
                log(`ü§ñ „Ç∏„É£„É≥„Éó! ‚Üí (${this.x}, ${this.y})`);
            }

            collect() {
                if (this.isStar()) {
                    this.starsCollected++;
                    this.moves.push({ type: 'collectStar', x: this.x, y: this.y });
                    log(`‚≠ê Êòü„ÇíÂèéÈõÜ! (${this.starsCollected}ÂÄã)`);
                }
            }

            collectGem() {
                if (this.isGem()) {
                    this.gemsCollected++;
                    this.moves.push({ type: 'collectGem', x: this.x, y: this.y });
                    log(`üíé „Ç∏„Çß„É†„ÇíÂèéÈõÜ! (${this.gemsCollected}ÂÄã)`);
                }
            }

            checkObstacleAt(x, y) {
                if (!this.currentLevel) return false;
                return this.currentLevel.obstacles.some(o => o.x === x && o.y === y);
            }

            isObstacle() {
                return this.checkObstacleAt(this.x + 1, this.y);
            }

            isStar() {
                if (!this.currentLevel) return false;
                return this.currentLevel.stars.includes(this.x);
            }

            isGem() {
                if (!this.currentLevel) return false;
                return this.currentLevel.gems.includes(this.x);
            }

            isGoal() {
                if (!this.currentLevel) return false;
                return this.x === this.currentLevel.goalX && this.y === this.currentLevel.goalY;
            }
        }

        // ===== GAME STATE =====
        const robot = new Robot();
        let currentLevelIndex = 0;
        let currentWorld = 1;
        let completedLevels = new Set();
        let levelStars = {};
        let totalStarsEarned = 0;
        let collectedStarsInLevel = new Set();
        let collectedGemsInLevel = new Set();

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const output = document.getElementById('output');

        // ===== STARFIELD BACKGROUND =====
        function createStarfield() {
            const starfield = document.getElementById('starfield');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = (Math.random() * 3 + 1) + 'px';
                star.style.height = star.style.width;
                star.style.animationDelay = Math.random() * 3 + 's';
                starfield.appendChild(star);
            }
        }
        createStarfield();

        // ===== LOGGING =====
        function log(message) {
            const p = document.createElement('p');
            p.innerHTML = message;
            output.appendChild(p);
            output.scrollTop = output.scrollHeight;
        }

        function clearLog() {
            output.innerHTML = '';
        }

        // ===== LEVEL MANAGEMENT =====
        function getWorldLevels(world) {
            return levels.filter(l => l.world === world);
        }

        function loadLevel(index) {
            currentLevelIndex = index;
            const level = levels[index];
            currentWorld = level.world;
            robot.setLevel(level);
            robot.reset();
            collectedStarsInLevel.clear();
            collectedGemsInLevel.clear();
            
            document.getElementById('challengeTitle').innerHTML = 
                `üéØ ${level.title}` + 
                (level.concept ? `<span class="new-concept">${level.concept}</span>` : '');
            document.getElementById('challengeDescription').innerHTML = level.description;
            document.getElementById('codeInput').value = level.initialCode;
            document.getElementById('hintBox').classList.remove('show');
            clearLog();
            drawCanvas();
            
            updateWorldButtons();
            updateLevelButtons();
            updateStats();
            updateLineNumbers();
            updateGameInfo();
        }

        function updateWorldButtons() {
            document.querySelectorAll('.world-btn').forEach(btn => {
                btn.classList.toggle('active', parseInt(btn.dataset.world) === currentWorld);
            });
        }

        function updateLevelButtons() {
            const selector = document.getElementById('levelSelector');
            selector.innerHTML = '';
            
            const worldLevels = getWorldLevels(currentWorld);
            
            worldLevels.forEach((level) => {
                const btn = document.createElement('button');
                btn.className = 'level-btn';
                
                const globalIndex = levels.findIndex(l => l.id === level.id);
                
                if (globalIndex === currentLevelIndex) btn.classList.add('active');
                if (completedLevels.has(level.id)) btn.classList.add('completed');
                
                btn.textContent = level.id;
                
                // Add stars
                if (levelStars[level.id]) {
                    const starsDiv = document.createElement('span');
                    starsDiv.className = 'stars';
                    starsDiv.textContent = '‚≠ê'.repeat(levelStars[level.id]);
                    btn.appendChild(starsDiv);
                }
                
                btn.onclick = () => {
                    loadLevel(globalIndex);
                };
                selector.appendChild(btn);
            });
        }

        function updateStats() {
            document.getElementById('completedCount').textContent = completedLevels.size;
            document.getElementById('totalStars').textContent = totalStarsEarned;
        }

        function updateGameInfo() {
            document.getElementById('robotPos').textContent = `(${robot.x}, ${robot.y})`;
            document.getElementById('starsCollected').textContent = robot.starsCollected;
            document.getElementById('gemsCollected').textContent = robot.gemsCollected;
        }

        function updateLineNumbers() {
            const textarea = document.getElementById('codeInput');
            const lines = textarea.value.split('\n').length;
            const lineNumbers = document.getElementById('lineNumbers');
            lineNumbers.innerHTML = Array.from({length: lines}, (_, i) => i + 1).join('<br>');
        }

        // ===== DRAWING =====
        function drawCanvas() {
            const level = levels[currentLevelIndex];
            const cellSize = 50;
            const startX = 40;
            const startY = 200;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw grid background
            drawGrid(startX, startY, cellSize);
            
            // Draw path
            drawPath(startX, startY, cellSize, level.goalX);
            
            // Draw obstacles
            drawObstacles(startX, startY, cellSize, level.obstacles);
            
            // Draw stars
            drawStars(startX, startY, cellSize, level.stars);
            
            // Draw gems
            drawGems(startX, startY, cellSize, level.gems);
            
            // Draw goal
            drawGoal(startX + level.goalX * cellSize, startY, cellSize);
            
            // Draw robot
            drawRobot(startX + robot.x * cellSize + cellSize / 2, startY - robot.y * cellSize - cellSize / 2 + 10, cellSize);
        }

        function drawGrid(startX, startY, cellSize) {
            const isLightMode = document.body.classList.contains('light-mode');
            ctx.strokeStyle = isLightMode ? 'rgba(71, 85, 105, 0.25)' : 'rgba(0, 245, 255, 0.1)';
            ctx.lineWidth = 1;
            
            for (let i = 0; i <= 12; i++) {
                ctx.beginPath();
                ctx.moveTo(startX + i * cellSize, 50);
                ctx.lineTo(startX + i * cellSize, 350);
                ctx.stroke();
            }
            
            for (let i = 0; i <= 6; i++) {
                ctx.beginPath();
                ctx.moveTo(startX, 50 + i * cellSize);
                ctx.lineTo(startX + 12 * cellSize, 50 + i * cellSize);
                ctx.stroke();
            }
        }

        function drawPath(startX, startY, cellSize, goalX) {
            const isLightMode = document.body.classList.contains('light-mode');
            
            let gradient;
            if (isLightMode) {
                gradient = ctx.createLinearGradient(startX, 0, startX + (goalX + 1) * cellSize, 0);
                gradient.addColorStop(0, 'rgba(203, 213, 225, 0.9)');
                gradient.addColorStop(1, 'rgba(16, 185, 129, 0.3)');
            } else {
                gradient = ctx.createLinearGradient(startX, 0, startX + (goalX + 1) * cellSize, 0);
                gradient.addColorStop(0, 'rgba(30, 42, 69, 0.8)');
                gradient.addColorStop(1, 'rgba(0, 255, 136, 0.2)');
            }
            
            ctx.fillStyle = gradient;
            ctx.fillRect(startX, startY - cellSize + 10, (goalX + 1) * cellSize, cellSize);
            
            // Path border
            ctx.strokeStyle = isLightMode ? 'rgba(71, 85, 105, 0.5)' : 'rgba(0, 245, 255, 0.3)';
            ctx.lineWidth = 2;
            ctx.strokeRect(startX, startY - cellSize + 10, (goalX + 1) * cellSize, cellSize);
        }

        function drawObstacles(startX, startY, cellSize, obstacles) {
            const isLightMode = document.body.classList.contains('light-mode');
            
            obstacles.forEach(obs => {
                const x = startX + obs.x * cellSize;
                const y = startY - obs.y * cellSize - cellSize + 10;
                
                // Obstacle body with gradient
                const gradient = ctx.createLinearGradient(x, y, x, y + cellSize);
                gradient.addColorStop(0, '#ff2d75');
                gradient.addColorStop(1, '#c91a5a');
                
                ctx.fillStyle = gradient;
                ctx.fillRect(x + 5, y + 10, cellSize - 10, cellSize - 10);
                
                // Danger stripes
                ctx.strokeStyle = '#ffcc00';
                ctx.lineWidth = 3;
                for (let i = 0; i < 3; i++) {
                    ctx.beginPath();
                    ctx.moveTo(x + 10 + i * 12, y + 15);
                    ctx.lineTo(x + 10 + i * 12, y + cellSize - 5);
                    ctx.stroke();
                }
                
                // Border
                ctx.strokeStyle = isLightMode ? '#9f1239' : '#ff2d75';
                ctx.lineWidth = isLightMode ? 3 : 2;
                ctx.strokeRect(x + 5, y + 10, cellSize - 10, cellSize - 10);
                
                // Glow effect (only in dark mode)
                if (!isLightMode) {
                    ctx.shadowColor = '#ff2d75';
                    ctx.shadowBlur = 15;
                    ctx.strokeRect(x + 5, y + 10, cellSize - 10, cellSize - 10);
                    ctx.shadowBlur = 0;
                }
            });
        }

        function drawStars(startX, startY, cellSize, stars) {
            const isLightMode = document.body.classList.contains('light-mode');
            
            stars.forEach(starX => {
                if (collectedStarsInLevel.has(starX)) return;
                
                const x = startX + starX * cellSize + cellSize / 2;
                const y = startY - 60;
                
                // Glow (only in dark mode)
                if (!isLightMode) {
                    ctx.shadowColor = '#ffcc00';
                    ctx.shadowBlur = 20;
                }
                
                drawStarShape(ctx, x, y, 12, 5, '#ffcc00', '#ff9500');
                
                // Add outline in light mode
                if (isLightMode) {
                    ctx.strokeStyle = '#b45309';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
                
                ctx.shadowBlur = 0;
            });
        }

        function drawGems(startX, startY, cellSize, gems) {
            const isLightMode = document.body.classList.contains('light-mode');
            
            gems.forEach(gemX => {
                if (collectedGemsInLevel.has(gemX)) return;
                
                const x = startX + gemX * cellSize + cellSize / 2;
                const y = startY - 75;
                
                // Glow (only in dark mode)
                if (!isLightMode) {
                    ctx.shadowColor = '#b14eff';
                    ctx.shadowBlur = 15;
                }
                
                ctx.fillStyle = '#b14eff';
                ctx.beginPath();
                ctx.moveTo(x, y - 10);
                ctx.lineTo(x + 8, y);
                ctx.lineTo(x, y + 10);
                ctx.lineTo(x - 8, y);
                ctx.closePath();
                ctx.fill();
                
                // Add outline in light mode
                if (isLightMode) {
                    ctx.strokeStyle = '#7c3aed';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
                
                // Shine
                ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
                ctx.beginPath();
                ctx.moveTo(x - 2, y - 5);
                ctx.lineTo(x + 3, y - 5);
                ctx.lineTo(x, y);
                ctx.closePath();
                ctx.fill();
                
                ctx.shadowBlur = 0;
            });
        }

        function drawStarShape(ctx, cx, cy, outerR, points, color1, color2) {
            const gradient = ctx.createRadialGradient(cx, cy, 0, cx, cy, outerR);
            gradient.addColorStop(0, color1);
            gradient.addColorStop(1, color2);
            
            ctx.fillStyle = gradient;
            ctx.beginPath();
            
            for (let i = 0; i < points * 2; i++) {
                const angle = (i * Math.PI) / points - Math.PI / 2;
                const radius = i % 2 === 0 ? outerR : outerR / 2;
                const x = cx + Math.cos(angle) * radius;
                const y = cy + Math.sin(angle) * radius;
                
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            
            ctx.closePath();
            ctx.fill();
        }

        function drawGoal(x, y, cellSize) {
            const isLightMode = document.body.classList.contains('light-mode');
            
            // Goal platform
            const gradient = ctx.createLinearGradient(x, y - cellSize, x, y + 10);
            gradient.addColorStop(0, '#00ff88');
            gradient.addColorStop(1, '#00cc6a');
            
            ctx.fillStyle = gradient;
            ctx.fillRect(x + 5, y - cellSize + 10, cellSize - 10, cellSize);
            
            // Border for visibility
            ctx.strokeStyle = isLightMode ? '#047857' : '#00ff88';
            ctx.lineWidth = isLightMode ? 3 : 2;
            ctx.strokeRect(x + 5, y - cellSize + 10, cellSize - 10, cellSize);
            
            // Glow (only in dark mode)
            if (!isLightMode) {
                ctx.shadowColor = '#00ff88';
                ctx.shadowBlur = 20;
                ctx.strokeRect(x + 5, y - cellSize + 10, cellSize - 10, cellSize);
                ctx.shadowBlur = 0;
            }
            
            // Flag pole
            ctx.fillStyle = isLightMode ? '#047857' : '#00ff88';
            ctx.fillRect(x + cellSize / 2 - 2, y - cellSize - 20, 4, 40);
            
            // Flag
            ctx.fillStyle = '#ff2d75';
            ctx.beginPath();
            ctx.moveTo(x + cellSize / 2 + 2, y - cellSize - 15);
            ctx.lineTo(x + cellSize / 2 + 25, y - cellSize - 5);
            ctx.lineTo(x + cellSize / 2 + 2, y - cellSize + 5);
            ctx.closePath();
            ctx.fill();
            
            // Flag border in light mode
            if (isLightMode) {
                ctx.strokeStyle = '#9f1239';
                ctx.lineWidth = 2;
                ctx.stroke();
            }
        }

        function drawRobot(x, y, cellSize) {
            drawRobotWithColors(ctx, x, y, selectedCharacter.colors, 1, cellSize);
        }
        
        function drawRobotWithColors(ctx, x, y, colors, scale = 1, cellSize = 50) {
            const size = cellSize * 0.7 * scale;
            
            // Shadow
            ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
            ctx.beginPath();
            ctx.ellipse(x, y + size / 2 + 5 * scale, size / 2, 8 * scale, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Body glow
            ctx.shadowColor = colors.body;
            ctx.shadowBlur = 20 * scale;
            
            // Body
            const bodyGradient = ctx.createLinearGradient(x - size/2, y - size/2, x + size/2, y + size/2);
            bodyGradient.addColorStop(0, colors.body);
            bodyGradient.addColorStop(0.5, colors.bodyGlow);
            bodyGradient.addColorStop(1, colors.bodyGlow);
            
            ctx.fillStyle = bodyGradient;
            ctx.beginPath();
            ctx.roundRect(x - size/2, y - size/2, size, size, 8 * scale);
            ctx.fill();
            
            ctx.shadowBlur = 0;
            
            // Face plate
            ctx.fillStyle = '#0a1520';
            ctx.beginPath();
            ctx.roundRect(x - size/2 + 5 * scale, y - size/2 + 5 * scale, size - 10 * scale, size/2, 5 * scale);
            ctx.fill();
            
            // Eyes
            const eyeY = y - size/4;
            const eyeSpacing = size / 4;
            
            // Eye glow
            ctx.shadowColor = colors.eye;
            ctx.shadowBlur = 10 * scale;
            
            // Left eye
            ctx.fillStyle = colors.eye;
            ctx.beginPath();
            ctx.arc(x - eyeSpacing, eyeY, 6 * scale, 0, Math.PI * 2);
            ctx.fill();
            
            // Right eye
            ctx.beginPath();
            ctx.arc(x + eyeSpacing, eyeY, 6 * scale, 0, Math.PI * 2);
            ctx.fill();
            
            // Eye highlights
            ctx.shadowBlur = 0;
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(x - eyeSpacing - 2 * scale, eyeY - 2 * scale, 2 * scale, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(x + eyeSpacing - 2 * scale, eyeY - 2 * scale, 2 * scale, 0, Math.PI * 2);
            ctx.fill();
            
            // Mouth (smile)
            ctx.strokeStyle = colors.eye;
            ctx.lineWidth = 2 * scale;
            ctx.beginPath();
            ctx.arc(x, y + 2 * scale, 8 * scale, 0.1 * Math.PI, 0.9 * Math.PI);
            ctx.stroke();
            
            // Antenna
            ctx.strokeStyle = colors.body;
            ctx.lineWidth = 3 * scale;
            ctx.beginPath();
            ctx.moveTo(x, y - size/2);
            ctx.lineTo(x, y - size/2 - 15 * scale);
            ctx.stroke();
            
            // Antenna ball with glow
            ctx.shadowColor = colors.antenna;
            ctx.shadowBlur = 15 * scale;
            ctx.fillStyle = colors.antenna;
            ctx.beginPath();
            ctx.arc(x, y - size/2 - 18 * scale, 5 * scale, 0, Math.PI * 2);
            ctx.fill();
            ctx.shadowBlur = 0;
            
            // Chest panel
            ctx.fillStyle = '#0a1520';
            ctx.beginPath();
            ctx.roundRect(x - 12 * scale, y + 5 * scale, 24 * scale, 12 * scale, 3 * scale);
            ctx.fill();
            
            // Chest lights
            const lightColors = colors.chest;
            for (let i = 0; i < 3; i++) {
                ctx.fillStyle = lightColors[i];
                ctx.beginPath();
                ctx.arc(x - 8 * scale + i * 8 * scale, y + 11 * scale, 3 * scale, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Arms
            ctx.fillStyle = colors.bodyGlow;
            ctx.fillRect(x - size/2 - 8 * scale, y - 5 * scale, 8 * scale, 20 * scale);
            ctx.fillRect(x + size/2, y - 5 * scale, 8 * scale, 20 * scale);
            
            // Hands
            ctx.fillStyle = colors.body;
            ctx.beginPath();
            ctx.arc(x - size/2 - 4 * scale, y + 18 * scale, 6 * scale, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(x + size/2 + 4 * scale, y + 18 * scale, 6 * scale, 0, Math.PI * 2);
            ctx.fill();
        }

        // ===== ANIMATION =====
        async function animateRobot() {
            const cellSize = 50;
            const startX = 40;
            const startY = 200;
            
            for (const move of robot.moves) {
                if (move.type === 'collectStar') {
                    collectedStarsInLevel.add(move.x);
                    createParticles(startX + move.x * cellSize + cellSize/2, startY - 60, '#ffcc00');
                    drawCanvas();
                    await sleep(200);
                    continue;
                }
                
                if (move.type === 'collectGem') {
                    collectedGemsInLevel.add(move.x);
                    createParticles(startX + move.x * cellSize + cellSize/2, startY - 75, '#b14eff');
                    drawCanvas();
                    await sleep(200);
                    continue;
                }
                
                const frames = 15;
                for (let frame = 0; frame <= frames; frame++) {
                    const progress = frame / frames;
                    const easeProgress = 1 - Math.pow(1 - progress, 3); // easeOutCubic
                    
                    let currentX = move.fromX + (move.toX - move.fromX) * easeProgress;
                    let currentY = move.fromY + (move.toY - move.fromY) * easeProgress;
                    let jumpOffset = 0;
                    
                    if (move.type === 'jump') {
                        jumpOffset = Math.sin(progress * Math.PI) * 40;
                    }
                    
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    drawGrid(startX, startY, cellSize);
                    drawPath(startX, startY, cellSize, levels[currentLevelIndex].goalX);
                    drawObstacles(startX, startY, cellSize, levels[currentLevelIndex].obstacles);
                    drawStars(startX, startY, cellSize, levels[currentLevelIndex].stars);
                    drawGems(startX, startY, cellSize, levels[currentLevelIndex].gems);
                    drawGoal(startX + levels[currentLevelIndex].goalX * cellSize, startY, cellSize);
                    
                    drawRobot(
                        startX + currentX * cellSize + cellSize/2,
                        startY - currentY * cellSize - cellSize/2 + 10 - jumpOffset,
                        cellSize
                    );
                    
                    await sleep(20);
                }
                
                updateGameInfo();
            }
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // ===== PARTICLE EFFECTS =====
        function createParticles(x, y, color) {
            for (let i = 0; i < 12; i++) {
                const angle = (Math.PI * 2 / 12) * i;
                const speed = 3 + Math.random() * 2;
                const particle = {
                    x, y,
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed,
                    life: 1,
                    color
                };
                animateParticle(particle);
            }
        }

        async function animateParticle(particle) {
            while (particle.life > 0) {
                particle.x += particle.vx;
                particle.y += particle.vy;
                particle.vy += 0.2;
                particle.life -= 0.05;
                
                ctx.globalAlpha = particle.life;
                ctx.fillStyle = particle.color;
                ctx.beginPath();
                ctx.arc(particle.x, particle.y, 4 * particle.life, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1;
                
                await sleep(16);
            }
        }

        // ===== CELEBRATION =====
        function showCelebration() {
            const container = document.getElementById('celebrationContainer');
            const colors = ['#ff2d75', '#00f5ff', '#ffcc00', '#00ff88', '#b14eff'];
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 0.5 + 's';
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                container.appendChild(confetti);
                
                setTimeout(() => confetti.remove(), 3000);
            }
        }

        function showLevelComplete(starsEarned) {
            const modal = document.getElementById('levelCompleteModal');
            const starsDisplay = document.getElementById('modalStars');
            const message = document.getElementById('modalMessage');
            
            starsDisplay.textContent = '‚≠ê'.repeat(starsEarned) + '‚òÜ'.repeat(3 - starsEarned);
            
            if (starsEarned === 3) {
                message.textContent = 'ÂÆåÁíß! Á¥†Êô¥„Çâ„Åó„ÅÑ„Ç≥„Éº„Éâ„Å†!';
            } else if (starsEarned === 2) {
                message.textContent = '„ÅÑ„ÅÑÊÑü„Åò! „ÇÇ„Å£„Å®ÂäπÁéáÁöÑ„Å´Êõ∏„Åë„Çã„Åã„Å™?';
            } else {
                message.textContent = '„ÇØ„É™„Ç¢! „ÇÇ„ÅÜ‰∏ÄÂ∫¶ÊåëÊà¶„Åó„Å¶„Åø„Çà„ÅÜ!';
            }
            
            modal.classList.add('show');
            showCelebration();
        }

        // ===== EVENT HANDLERS =====
        document.getElementById('runBtn').addEventListener('click', async () => {
            const code = document.getElementById('codeInput').value;
            clearLog();
            robot.reset();
            collectedStarsInLevel.clear();
            collectedGemsInLevel.clear();
            drawCanvas();
            
            try {
                log('üöÄ „Ç≥„Éº„Éâ„ÇíÂÆüË°å‰∏≠...');
                
                // Execute user code
                const wrappedCode = `
                    (function() {
                        ${code}
                    })();
                `;
                eval(wrappedCode);
                
                await animateRobot();
                
                const level = levels[currentLevelIndex];
                if (level.validate(robot)) {
                    // Calculate stars
                    const codeLength = code.replace(/\s+/g, '').length;
                    let starsEarned = 1;
                    if (codeLength < 200) starsEarned = 2;
                    if (codeLength < 100) starsEarned = 3;
                    
                    // Update progress
                    if (!completedLevels.has(level.id)) {
                        completedLevels.add(level.id);
                    }
                    
                    if (!levelStars[level.id] || levelStars[level.id] < starsEarned) {
                        totalStarsEarned += starsEarned - (levelStars[level.id] || 0);
                        levelStars[level.id] = starsEarned;
                    }
                    
                    updateStats();
                    updateLevelButtons();
                    
                    setTimeout(() => showLevelComplete(starsEarned), 500);
                } else {
                    updateStats();
                    
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'error-message';
                    errorDiv.textContent = '‚ùå „Ç¥„Éº„É´„Å´Âà∞ÈÅî„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶ÊåëÊà¶!';
                    output.appendChild(errorDiv);
                }
            } catch (error) {
                updateStats();
                
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-message';
                errorDiv.textContent = '‚ùå „Ç®„É©„Éº: ' + error.message;
                output.appendChild(errorDiv);
            }
        });

        document.getElementById('hintBtn').addEventListener('click', () => {
            const hintBox = document.getElementById('hintBox');
            const level = levels[currentLevelIndex];
            hintBox.innerHTML = `<strong>üí° „Éí„É≥„Éà:</strong><code>${level.hint}</code>`;
            hintBox.classList.toggle('show');
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            loadLevel(currentLevelIndex);
        });

        document.getElementById('nextLevelBtn').addEventListener('click', () => {
            document.getElementById('levelCompleteModal').classList.remove('show');
            if (currentLevelIndex < levels.length - 1) {
                loadLevel(currentLevelIndex + 1);
            }
        });

        document.querySelectorAll('.world-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                currentWorld = parseInt(btn.dataset.world);
                const worldLevels = getWorldLevels(currentWorld);
                const firstLevelIndex = levels.findIndex(l => l.id === worldLevels[0].id);
                loadLevel(firstLevelIndex);
            });
        });

        document.getElementById('codeInput').addEventListener('input', updateLineNumbers);
        document.getElementById('codeInput').addEventListener('scroll', function() {
            document.getElementById('lineNumbers').scrollTop = this.scrollTop;
        });

        // Initialize
        loadSavedPreferences();
        initCharacterSelector();
        loadLevel(0);
        
        // Theme Toggle
        document.getElementById('themeToggle').addEventListener('click', toggleTheme);
        
        // Character Selector
        const characterBtn = document.getElementById('characterBtn');
        const characterModal = document.getElementById('characterModal');
        const closeCharacterModal = document.getElementById('closeCharacterModal');
        
        characterBtn.addEventListener('click', () => {
            initCharacterSelector();
            characterModal.classList.add('show');
        });
        
        closeCharacterModal.addEventListener('click', () => {
            characterModal.classList.remove('show');
        });
        
        characterModal.addEventListener('click', (e) => {
            if (e.target === characterModal) {
                characterModal.classList.remove('show');
            }
        });
        
        // Quick Reference Panel Toggle
        const floatingHelpBtn = document.getElementById('floatingHelpBtn');
        const quickRefPanel = document.getElementById('quickRefPanel');
        const closeQuickRef = document.getElementById('closeQuickRef');
        
        floatingHelpBtn.addEventListener('click', () => {
            quickRefPanel.classList.toggle('open');
            floatingHelpBtn.classList.toggle('active');
        });
        
        closeQuickRef.addEventListener('click', () => {
            quickRefPanel.classList.remove('open');
            floatingHelpBtn.classList.remove('active');
        });
    </script>
</body>
</html>